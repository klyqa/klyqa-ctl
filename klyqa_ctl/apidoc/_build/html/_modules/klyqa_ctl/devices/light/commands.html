
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>klyqa_ctl.devices.light.commands &#8212; klyqa_ctl  documentation</title>
    <link rel="stylesheet" type="text/css" href="../../../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../../../_static/alabaster.css" />
    <script data-url_root="../../../../" id="documentation_options" src="../../../../_static/documentation_options.js"></script>
    <script src="../../../../_static/doctools.js"></script>
    <script src="../../../../_static/sphinx_highlight.js"></script>
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" />
   
  <link rel="stylesheet" href="../../../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <h1>Source code for klyqa_ctl.devices.light.commands</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;Contains all functions for light commands.&quot;&quot;&quot;</span>
<span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">annotations</span>

<span class="kn">from</span> <span class="nn">abc</span> <span class="kn">import</span> <span class="n">abstractmethod</span>
<span class="kn">import</span> <span class="nn">argparse</span>
<span class="kn">from</span> <span class="nn">dataclasses</span> <span class="kn">import</span> <span class="n">dataclass</span>
<span class="kn">from</span> <span class="nn">enum</span> <span class="kn">import</span> <span class="n">Enum</span>
<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Any</span><span class="p">,</span> <span class="n">Callable</span>

<span class="kn">from</span> <span class="nn">klyqa_ctl.devices.device</span> <span class="kn">import</span> <span class="n">CommandWithCheckValues</span><span class="p">,</span> <span class="n">Device</span>
<span class="kn">from</span> <span class="nn">klyqa_ctl.devices.light.light</span> <span class="kn">import</span> <span class="n">Light</span>
<span class="kn">from</span> <span class="nn">klyqa_ctl.devices.light.scenes</span> <span class="kn">import</span> <span class="n">SCENES</span>
<span class="kn">from</span> <span class="nn">klyqa_ctl.general.general</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">LOGGER</span><span class="p">,</span>
    <span class="n">CloudStateCommand</span><span class="p">,</span>
    <span class="n">Command</span><span class="p">,</span>
    <span class="n">CommandType</span><span class="p">,</span>
    <span class="n">CommandTyped</span><span class="p">,</span>
    <span class="n">DeviceType</span><span class="p">,</span>
    <span class="n">RgbColor</span><span class="p">,</span>
    <span class="n">TypeJson</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span> <span class="nn">klyqa_ctl.general.parameters</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">add_config_args</span><span class="p">,</span>
    <span class="n">get_description_parser</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">COMMANDS_TO_SEND</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s2">&quot;request&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ping&quot;</span><span class="p">,</span>
    <span class="s2">&quot;color&quot;</span><span class="p">,</span>
    <span class="s2">&quot;temperature&quot;</span><span class="p">,</span>
    <span class="s2">&quot;brightness&quot;</span><span class="p">,</span>
    <span class="s2">&quot;routine_list&quot;</span><span class="p">,</span>
    <span class="s2">&quot;routine_put&quot;</span><span class="p">,</span>
    <span class="s2">&quot;routine_id&quot;</span><span class="p">,</span>
    <span class="s2">&quot;routine_commands&quot;</span><span class="p">,</span>
    <span class="s2">&quot;routine_delete&quot;</span><span class="p">,</span>
    <span class="s2">&quot;routine_start&quot;</span><span class="p">,</span>
    <span class="s2">&quot;power&quot;</span><span class="p">,</span>
    <span class="s2">&quot;reboot&quot;</span><span class="p">,</span>
    <span class="s2">&quot;factory_reset&quot;</span><span class="p">,</span>
    <span class="s2">&quot;WW&quot;</span><span class="p">,</span>
    <span class="s2">&quot;daylight&quot;</span><span class="p">,</span>
    <span class="s2">&quot;CW&quot;</span><span class="p">,</span>
    <span class="s2">&quot;nightlight&quot;</span><span class="p">,</span>
    <span class="s2">&quot;relax&quot;</span><span class="p">,</span>
    <span class="s2">&quot;TVtime&quot;</span><span class="p">,</span>
    <span class="s2">&quot;comfort&quot;</span><span class="p">,</span>
    <span class="s2">&quot;focused&quot;</span><span class="p">,</span>
    <span class="s2">&quot;fireplace&quot;</span><span class="p">,</span>
    <span class="s2">&quot;club&quot;</span><span class="p">,</span>
    <span class="s2">&quot;romantic&quot;</span><span class="p">,</span>
    <span class="s2">&quot;gentle&quot;</span><span class="p">,</span>
    <span class="s2">&quot;summer&quot;</span><span class="p">,</span>
    <span class="s2">&quot;jungle&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ocean&quot;</span><span class="p">,</span>
    <span class="s2">&quot;fall&quot;</span><span class="p">,</span>
    <span class="s2">&quot;sunset&quot;</span><span class="p">,</span>
    <span class="s2">&quot;party&quot;</span><span class="p">,</span>
    <span class="s2">&quot;spring&quot;</span><span class="p">,</span>
    <span class="s2">&quot;forest&quot;</span><span class="p">,</span>
    <span class="s2">&quot;deep_sea&quot;</span><span class="p">,</span>
    <span class="s2">&quot;tropical&quot;</span><span class="p">,</span>
    <span class="s2">&quot;magic&quot;</span><span class="p">,</span>
    <span class="s2">&quot;mystic&quot;</span><span class="p">,</span>
    <span class="s2">&quot;cotton&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ice&quot;</span><span class="p">,</span>
<span class="p">]</span>


<div class="viewcode-block" id="RequestCommand"><a class="viewcode-back" href="../../../../klyqa_ctl.devices.light.html#klyqa_ctl.devices.light.commands.RequestCommand">[docs]</a><span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">RequestCommand</span><span class="p">(</span><span class="n">CommandTyped</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Request command.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__post_init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="n">CommandType</span><span class="o">.</span><span class="n">REQUEST</span><span class="o">.</span><span class="n">value</span></div>


<div class="viewcode-block" id="PingCommand"><a class="viewcode-back" href="../../../../klyqa_ctl.devices.light.html#klyqa_ctl.devices.light.commands.PingCommand">[docs]</a><span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">PingCommand</span><span class="p">(</span><span class="n">CommandTyped</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Ping command.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__post_init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="n">CommandType</span><span class="o">.</span><span class="n">PING</span><span class="o">.</span><span class="n">value</span></div>


<div class="viewcode-block" id="FwUpdateCommand"><a class="viewcode-back" href="../../../../klyqa_ctl.devices.light.html#klyqa_ctl.devices.light.commands.FwUpdateCommand">[docs]</a><span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">FwUpdateCommand</span><span class="p">(</span><span class="n">CommandTyped</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Firmware update command.&quot;&quot;&quot;</span>

    <span class="n">url</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__post_init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="n">CommandType</span><span class="o">.</span><span class="n">FW_UPDATE</span><span class="o">.</span><span class="n">value</span>

<div class="viewcode-block" id="FwUpdateCommand.url_json"><a class="viewcode-back" href="../../../../klyqa_ctl.devices.light.html#klyqa_ctl.devices.light.commands.FwUpdateCommand.url_json">[docs]</a>    <span class="k">def</span> <span class="nf">url_json</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">TypeJson</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;url&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">url</span><span class="p">}</span></div>

<div class="viewcode-block" id="FwUpdateCommand.json"><a class="viewcode-back" href="../../../../klyqa_ctl.devices.light.html#klyqa_ctl.devices.light.commands.FwUpdateCommand.json">[docs]</a>    <span class="k">def</span> <span class="nf">json</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">TypeJson</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">json</span><span class="p">()</span> <span class="o">|</span> <span class="bp">self</span><span class="o">.</span><span class="n">url_json</span><span class="p">()</span></div></div>


<div class="viewcode-block" id="TransitionCommand"><a class="viewcode-back" href="../../../../klyqa_ctl.devices.light.html#klyqa_ctl.devices.light.commands.TransitionCommand">[docs]</a><span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">TransitionCommand</span><span class="p">(</span><span class="n">RequestCommand</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Transition command.&quot;&quot;&quot;</span>

    <span class="n">transition_time</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span>

<div class="viewcode-block" id="TransitionCommand.json"><a class="viewcode-back" href="../../../../klyqa_ctl.devices.light.html#klyqa_ctl.devices.light.commands.TransitionCommand.json">[docs]</a>    <span class="k">def</span> <span class="nf">json</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">TypeJson</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">json</span><span class="p">()</span> <span class="o">|</span> <span class="p">{</span><span class="s2">&quot;transitionTime&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">transition_time</span><span class="p">}</span></div></div>


<div class="viewcode-block" id="CommandWithCheckValuesLight"><a class="viewcode-back" href="../../../../klyqa_ctl.devices.light.html#klyqa_ctl.devices.light.commands.CommandWithCheckValuesLight">[docs]</a><span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">CommandWithCheckValuesLight</span><span class="p">(</span><span class="n">CommandWithCheckValues</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Check command values range limits.&quot;&quot;&quot;</span>

    <span class="n">_light</span><span class="p">:</span> <span class="n">Light</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>

<div class="viewcode-block" id="CommandWithCheckValuesLight.check_values"><a class="viewcode-back" href="../../../../klyqa_ctl.devices.light.html#klyqa_ctl.devices.light.commands.CommandWithCheckValuesLight.check_values">[docs]</a>    <span class="nd">@abstractmethod</span>
    <span class="k">def</span> <span class="nf">check_values</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">device</span><span class="p">:</span> <span class="n">Device</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">device</span><span class="p">,</span> <span class="n">Light</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_light</span> <span class="o">=</span> <span class="n">device</span>
        <span class="k">return</span> <span class="kc">True</span></div></div>


<div class="viewcode-block" id="ColorCommand"><a class="viewcode-back" href="../../../../klyqa_ctl.devices.light.html#klyqa_ctl.devices.light.commands.ColorCommand">[docs]</a><span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">ColorCommand</span><span class="p">(</span>
    <span class="n">CommandWithCheckValuesLight</span><span class="p">,</span> <span class="n">TransitionCommand</span><span class="p">,</span> <span class="n">CloudStateCommand</span>
<span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Color command.&quot;&quot;&quot;</span>

    <span class="n">color</span><span class="p">:</span> <span class="n">RgbColor</span> <span class="o">=</span> <span class="n">RgbColor</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

<div class="viewcode-block" id="ColorCommand.color_json"><a class="viewcode-back" href="../../../../klyqa_ctl.devices.light.html#klyqa_ctl.devices.light.commands.ColorCommand.color_json">[docs]</a>    <span class="k">def</span> <span class="nf">color_json</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">TypeJson</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="s2">&quot;color&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;red&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">color</span><span class="o">.</span><span class="n">r</span><span class="p">,</span>
                <span class="s2">&quot;green&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">color</span><span class="o">.</span><span class="n">g</span><span class="p">,</span>
                <span class="s2">&quot;blue&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">color</span><span class="o">.</span><span class="n">b</span><span class="p">,</span>
            <span class="p">}</span>
        <span class="p">}</span></div>

<div class="viewcode-block" id="ColorCommand.json"><a class="viewcode-back" href="../../../../klyqa_ctl.devices.light.html#klyqa_ctl.devices.light.commands.ColorCommand.json">[docs]</a>    <span class="k">def</span> <span class="nf">json</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">TypeJson</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">json</span><span class="p">()</span> <span class="o">|</span> <span class="bp">self</span><span class="o">.</span><span class="n">color_json</span><span class="p">()</span></div>

<div class="viewcode-block" id="ColorCommand.check_values"><a class="viewcode-back" href="../../../../klyqa_ctl.devices.light.html#klyqa_ctl.devices.light.commands.ColorCommand.check_values">[docs]</a>    <span class="k">def</span> <span class="nf">check_values</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">device</span><span class="p">:</span> <span class="n">Device</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Check device color range.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">check_values</span><span class="p">(</span><span class="n">device</span><span class="p">)</span> <span class="ow">or</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_light</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="n">values</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">color</span><span class="o">.</span><span class="n">r</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">color</span><span class="o">.</span><span class="n">g</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">color</span><span class="o">.</span><span class="n">b</span><span class="p">]</span>
        <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_light</span><span class="o">.</span><span class="n">ident</span> <span class="ow">or</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_light</span><span class="o">.</span><span class="n">color_range</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span>
            <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_light</span><span class="o">.</span><span class="n">ident</span>
            <span class="ow">or</span> <span class="n">missing_config</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_force</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_light</span><span class="o">.</span><span class="n">ident</span><span class="o">.</span><span class="n">product_id</span><span class="p">)</span>
        <span class="p">):</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_light</span><span class="o">.</span><span class="n">color_range</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">values</span><span class="p">:</span>
                <span class="k">if</span> <span class="p">(</span>
                    <span class="nb">int</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">_light</span><span class="o">.</span><span class="n">color_range</span><span class="o">.</span><span class="n">min</span>
                    <span class="ow">or</span> <span class="nb">int</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">_light</span><span class="o">.</span><span class="n">color_range</span><span class="o">.</span><span class="n">max</span>
                <span class="p">):</span>
                    <span class="k">return</span> <span class="n">forced_continue</span><span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_force</span><span class="p">,</span>
                        <span class="sa">f</span><span class="s2">&quot;Color </span><span class="si">{</span><span class="n">value</span><span class="si">}</span><span class="s2"> out of range&quot;</span>
                        <span class="sa">f</span><span class="s2">&quot; [</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_light</span><span class="o">.</span><span class="n">color_range</span><span class="o">.</span><span class="n">min</span><span class="si">}</span><span class="s2">..&quot;</span>
                        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_light</span><span class="o">.</span><span class="n">color_range</span><span class="o">.</span><span class="n">max</span><span class="si">}</span><span class="s2">].&quot;</span><span class="p">,</span>
                    <span class="p">)</span>
        <span class="k">return</span> <span class="kc">True</span></div></div>


<div class="viewcode-block" id="TemperatureCommand"><a class="viewcode-back" href="../../../../klyqa_ctl.devices.light.html#klyqa_ctl.devices.light.commands.TemperatureCommand">[docs]</a><span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">TemperatureCommand</span><span class="p">(</span>
    <span class="n">CommandWithCheckValuesLight</span><span class="p">,</span> <span class="n">TransitionCommand</span><span class="p">,</span> <span class="n">CloudStateCommand</span>
<span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Temperature command.&quot;&quot;&quot;</span>

    <span class="n">temperature</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span>

<div class="viewcode-block" id="TemperatureCommand.temperature_json"><a class="viewcode-back" href="../../../../klyqa_ctl.devices.light.html#klyqa_ctl.devices.light.commands.TemperatureCommand.temperature_json">[docs]</a>    <span class="k">def</span> <span class="nf">temperature_json</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">TypeJson</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;temperature&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">temperature</span><span class="p">}</span></div>

<div class="viewcode-block" id="TemperatureCommand.json"><a class="viewcode-back" href="../../../../klyqa_ctl.devices.light.html#klyqa_ctl.devices.light.commands.TemperatureCommand.json">[docs]</a>    <span class="k">def</span> <span class="nf">json</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">TypeJson</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">json</span><span class="p">()</span> <span class="o">|</span> <span class="bp">self</span><span class="o">.</span><span class="n">temperature_json</span><span class="p">()</span></div>

<div class="viewcode-block" id="TemperatureCommand.check_values"><a class="viewcode-back" href="../../../../klyqa_ctl.devices.light.html#klyqa_ctl.devices.light.commands.TemperatureCommand.check_values">[docs]</a>    <span class="k">def</span> <span class="nf">check_values</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">device</span><span class="p">:</span> <span class="n">Device</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Check device temperature range.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">check_values</span><span class="p">(</span><span class="n">device</span><span class="p">)</span> <span class="ow">or</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_light</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="n">value</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">temperature</span>

        <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_light</span><span class="o">.</span><span class="n">ident</span> <span class="ow">or</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_light</span><span class="o">.</span><span class="n">temperature_range</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span>
            <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_light</span><span class="o">.</span><span class="n">ident</span>
            <span class="ow">or</span> <span class="n">missing_config</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_force</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_light</span><span class="o">.</span><span class="n">ident</span><span class="o">.</span><span class="n">product_id</span><span class="p">)</span>
        <span class="p">):</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_light</span><span class="o">.</span><span class="n">temperature_range</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span>
                <span class="nb">int</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">_light</span><span class="o">.</span><span class="n">temperature_range</span><span class="o">.</span><span class="n">min</span>
                <span class="ow">or</span> <span class="nb">int</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">_light</span><span class="o">.</span><span class="n">temperature_range</span><span class="o">.</span><span class="n">max</span>
            <span class="p">):</span>
                <span class="k">return</span> <span class="n">forced_continue</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_force</span><span class="p">,</span>
                    <span class="sa">f</span><span class="s2">&quot;Temperature </span><span class="si">{</span><span class="n">value</span><span class="si">}</span><span class="s2"> out of range&quot;</span>
                    <span class="sa">f</span><span class="s2">&quot; [</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_light</span><span class="o">.</span><span class="n">temperature_range</span><span class="o">.</span><span class="n">min</span><span class="si">}</span><span class="s2">..&quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_light</span><span class="o">.</span><span class="n">temperature_range</span><span class="o">.</span><span class="n">max</span><span class="si">}</span><span class="s2">].&quot;</span><span class="p">,</span>
                <span class="p">)</span>
        <span class="k">return</span> <span class="kc">True</span></div></div>


<div class="viewcode-block" id="BrightnessCommand"><a class="viewcode-back" href="../../../../klyqa_ctl.devices.light.html#klyqa_ctl.devices.light.commands.BrightnessCommand">[docs]</a><span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">BrightnessCommand</span><span class="p">(</span>
    <span class="n">CommandWithCheckValuesLight</span><span class="p">,</span> <span class="n">TransitionCommand</span><span class="p">,</span> <span class="n">CloudStateCommand</span>
<span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Brightness command.&quot;&quot;&quot;</span>

    <span class="n">brightness</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span>

<div class="viewcode-block" id="BrightnessCommand.brightness_json"><a class="viewcode-back" href="../../../../klyqa_ctl.devices.light.html#klyqa_ctl.devices.light.commands.BrightnessCommand.brightness_json">[docs]</a>    <span class="k">def</span> <span class="nf">brightness_json</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">TypeJson</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="s2">&quot;brightness&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;percentage&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">brightness</span><span class="p">,</span>
            <span class="p">}</span>
        <span class="p">}</span></div>

<div class="viewcode-block" id="BrightnessCommand.json"><a class="viewcode-back" href="../../../../klyqa_ctl.devices.light.html#klyqa_ctl.devices.light.commands.BrightnessCommand.json">[docs]</a>    <span class="k">def</span> <span class="nf">json</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">TypeJson</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">json</span><span class="p">()</span> <span class="o">|</span> <span class="bp">self</span><span class="o">.</span><span class="n">brightness_json</span><span class="p">()</span></div>

<div class="viewcode-block" id="BrightnessCommand.check_values"><a class="viewcode-back" href="../../../../klyqa_ctl.devices.light.html#klyqa_ctl.devices.light.commands.BrightnessCommand.check_values">[docs]</a>    <span class="k">def</span> <span class="nf">check_values</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">device</span><span class="p">:</span> <span class="n">Device</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">check_values</span><span class="p">(</span><span class="n">device</span><span class="p">)</span> <span class="ow">or</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_light</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="n">value</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">brightness</span>

        <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_light</span><span class="o">.</span><span class="n">ident</span> <span class="ow">or</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_light</span><span class="o">.</span><span class="n">brightness_range</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span>
            <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_light</span><span class="o">.</span><span class="n">ident</span>
            <span class="ow">or</span> <span class="n">missing_config</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_force</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_light</span><span class="o">.</span><span class="n">ident</span><span class="o">.</span><span class="n">product_id</span><span class="p">)</span>
        <span class="p">):</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_light</span><span class="o">.</span><span class="n">brightness_range</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span>
                <span class="nb">int</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">_light</span><span class="o">.</span><span class="n">brightness_range</span><span class="o">.</span><span class="n">min</span>
                <span class="ow">or</span> <span class="nb">int</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">_light</span><span class="o">.</span><span class="n">brightness_range</span><span class="o">.</span><span class="n">max</span>
            <span class="p">):</span>
                <span class="k">return</span> <span class="n">forced_continue</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_force</span><span class="p">,</span>
                    <span class="sa">f</span><span class="s2">&quot;Brightness </span><span class="si">{</span><span class="n">value</span><span class="si">}</span><span class="s2"> out of range&quot;</span>
                    <span class="sa">f</span><span class="s2">&quot; [</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_light</span><span class="o">.</span><span class="n">brightness_range</span><span class="o">.</span><span class="n">min</span><span class="si">}</span><span class="s2">..&quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_light</span><span class="o">.</span><span class="n">brightness_range</span><span class="o">.</span><span class="n">max</span><span class="si">}</span><span class="s2">].&quot;</span><span class="p">,</span>
                <span class="p">)</span>
        <span class="k">return</span> <span class="kc">True</span></div></div>


<div class="viewcode-block" id="ExternalSourceProtocol"><a class="viewcode-back" href="../../../../klyqa_ctl.devices.light.html#klyqa_ctl.devices.light.commands.ExternalSourceProtocol">[docs]</a><span class="k">class</span> <span class="nc">ExternalSourceProtocol</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">Enum</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;External source protocol.&quot;&quot;&quot;</span>

    <span class="n">EXT_OFF</span> <span class="o">=</span> <span class="s2">&quot;EXT_OFF&quot;</span>
    <span class="n">EXT_UDP</span> <span class="o">=</span> <span class="s2">&quot;EXT_UDP&quot;</span>
    <span class="n">EXT_E131</span> <span class="o">=</span> <span class="s2">&quot;EXT_E131&quot;</span>
    <span class="n">EXT_TPM2</span> <span class="o">=</span> <span class="s2">&quot;EXT_TPM2&quot;</span></div>


<div class="viewcode-block" id="ExternalSourceCommand"><a class="viewcode-back" href="../../../../klyqa_ctl.devices.light.html#klyqa_ctl.devices.light.commands.ExternalSourceCommand">[docs]</a><span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">ExternalSourceCommand</span><span class="p">(</span><span class="n">CommandWithCheckValues</span><span class="p">,</span> <span class="n">RequestCommand</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Brightness command.&quot;&quot;&quot;</span>

    <span class="n">protocol</span><span class="p">:</span> <span class="n">ExternalSourceProtocol</span> <span class="o">=</span> <span class="n">ExternalSourceProtocol</span><span class="o">.</span><span class="n">EXT_OFF</span>
    <span class="n">port</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">channel</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span>

<div class="viewcode-block" id="ExternalSourceCommand.json"><a class="viewcode-back" href="../../../../klyqa_ctl.devices.light.html#klyqa_ctl.devices.light.commands.ExternalSourceCommand.json">[docs]</a>    <span class="k">def</span> <span class="nf">json</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">TypeJson</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">json</span><span class="p">()</span> <span class="o">|</span> <span class="p">{</span>
            <span class="s2">&quot;external&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;mode&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">protocol</span><span class="p">,</span>
                <span class="s2">&quot;port&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">port</span><span class="p">,</span>
                <span class="s2">&quot;channel&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">channel</span><span class="p">,</span>
            <span class="p">}</span>
        <span class="p">}</span></div>

<div class="viewcode-block" id="ExternalSourceCommand.check_values"><a class="viewcode-back" href="../../../../klyqa_ctl.devices.light.html#klyqa_ctl.devices.light.commands.ExternalSourceCommand.check_values">[docs]</a>    <span class="k">def</span> <span class="nf">check_values</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">device</span><span class="p">:</span> <span class="n">Device</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">True</span></div></div>

        <span class="c1"># return check_external_source_command(</span>
        <span class="c1">#     force, device, value=self.brightness</span>
        <span class="c1"># )</span>


<div class="viewcode-block" id="PowerCommand"><a class="viewcode-back" href="../../../../klyqa_ctl.devices.light.html#klyqa_ctl.devices.light.commands.PowerCommand">[docs]</a><span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">PowerCommand</span><span class="p">(</span><span class="n">RequestCommand</span><span class="p">,</span> <span class="n">CloudStateCommand</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Power command.&quot;&quot;&quot;</span>

    <span class="n">status</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;on&quot;</span></div>


<div class="viewcode-block" id="RebootCommand"><a class="viewcode-back" href="../../../../klyqa_ctl.devices.light.html#klyqa_ctl.devices.light.commands.RebootCommand">[docs]</a><span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">RebootCommand</span><span class="p">(</span><span class="n">CommandTyped</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Reboot command.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__post_init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="n">CommandType</span><span class="o">.</span><span class="n">REBOOT</span><span class="o">.</span><span class="n">value</span></div>


<div class="viewcode-block" id="FactoryResetCommand"><a class="viewcode-back" href="../../../../klyqa_ctl.devices.light.html#klyqa_ctl.devices.light.commands.FactoryResetCommand">[docs]</a><span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">FactoryResetCommand</span><span class="p">(</span><span class="n">CommandTyped</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Factory reset command.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__post_init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="n">CommandType</span><span class="o">.</span><span class="n">FACTORY_RESET</span><span class="o">.</span><span class="n">value</span></div>


<div class="viewcode-block" id="FadeCommand"><a class="viewcode-back" href="../../../../klyqa_ctl.devices.light.html#klyqa_ctl.devices.light.commands.FadeCommand">[docs]</a><span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">FadeCommand</span><span class="p">(</span><span class="n">RequestCommand</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Fade command.&quot;&quot;&quot;</span>

    <span class="n">fade_in</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">fade_out</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span></div>


<div class="viewcode-block" id="RoutineAction"><a class="viewcode-back" href="../../../../klyqa_ctl.devices.light.html#klyqa_ctl.devices.light.commands.RoutineAction">[docs]</a><span class="k">class</span> <span class="nc">RoutineAction</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">Enum</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Routine action.&quot;&quot;&quot;</span>

    <span class="n">LIST</span> <span class="o">=</span> <span class="s2">&quot;list&quot;</span>
    <span class="n">PUT</span> <span class="o">=</span> <span class="s2">&quot;put&quot;</span>
    <span class="n">START</span> <span class="o">=</span> <span class="s2">&quot;start&quot;</span>
    <span class="n">DELETE</span> <span class="o">=</span> <span class="s2">&quot;delete&quot;</span></div>


<div class="viewcode-block" id="RoutineCommand"><a class="viewcode-back" href="../../../../klyqa_ctl.devices.light.html#klyqa_ctl.devices.light.commands.RoutineCommand">[docs]</a><span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">RoutineCommand</span><span class="p">(</span><span class="n">CommandTyped</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Routine command.&quot;&quot;&quot;</span>

    <span class="n">action</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">RoutineAction</span><span class="o">.</span><span class="n">LIST</span><span class="o">.</span><span class="n">value</span>

    <span class="k">def</span> <span class="nf">__post_init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="n">CommandType</span><span class="o">.</span><span class="n">ROUTINE</span><span class="o">.</span><span class="n">value</span>

<div class="viewcode-block" id="RoutineCommand.json"><a class="viewcode-back" href="../../../../klyqa_ctl.devices.light.html#klyqa_ctl.devices.light.commands.RoutineCommand.json">[docs]</a>    <span class="k">def</span> <span class="nf">json</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">TypeJson</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">TypeJson</span><span class="p">(</span>
            <span class="p">{</span>
                <span class="n">k</span><span class="p">:</span> <span class="n">v</span>
                <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">k</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">v</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span> <span class="ow">and</span> <span class="n">v</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
            <span class="p">}</span>
        <span class="p">)</span></div></div>


<div class="viewcode-block" id="RoutineListCommand"><a class="viewcode-back" href="../../../../klyqa_ctl.devices.light.html#klyqa_ctl.devices.light.commands.RoutineListCommand">[docs]</a><span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">RoutineListCommand</span><span class="p">(</span><span class="n">RoutineCommand</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Routine list command.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__post_init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">__post_init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">action</span> <span class="o">=</span> <span class="n">RoutineAction</span><span class="o">.</span><span class="n">LIST</span><span class="o">.</span><span class="n">value</span></div>


<div class="viewcode-block" id="RoutineStartCommand"><a class="viewcode-back" href="../../../../klyqa_ctl.devices.light.html#klyqa_ctl.devices.light.commands.RoutineStartCommand">[docs]</a><span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">RoutineStartCommand</span><span class="p">(</span><span class="n">RoutineCommand</span><span class="p">,</span> <span class="n">TransitionCommand</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Routine start command.&quot;&quot;&quot;</span>

    <span class="nb">id</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>  <span class="c1"># routine_id</span>

    <span class="k">def</span> <span class="nf">__post_init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">__post_init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">action</span> <span class="o">=</span> <span class="n">RoutineAction</span><span class="o">.</span><span class="n">START</span><span class="o">.</span><span class="n">value</span></div>


<div class="viewcode-block" id="RoutineDeleteCommand"><a class="viewcode-back" href="../../../../klyqa_ctl.devices.light.html#klyqa_ctl.devices.light.commands.RoutineDeleteCommand">[docs]</a><span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">RoutineDeleteCommand</span><span class="p">(</span><span class="n">RoutineCommand</span><span class="p">,</span> <span class="n">TransitionCommand</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Routine delete command.&quot;&quot;&quot;</span>

    <span class="nb">id</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>  <span class="c1"># routine_id</span>

    <span class="k">def</span> <span class="nf">__post_init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">__post_init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">action</span> <span class="o">=</span> <span class="n">RoutineAction</span><span class="o">.</span><span class="n">DELETE</span><span class="o">.</span><span class="n">value</span></div>


<div class="viewcode-block" id="RoutinePutCommand"><a class="viewcode-back" href="../../../../klyqa_ctl.devices.light.html#klyqa_ctl.devices.light.commands.RoutinePutCommand">[docs]</a><span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">RoutinePutCommand</span><span class="p">(</span>
    <span class="n">RoutineCommand</span><span class="p">,</span> <span class="n">CommandWithCheckValuesLight</span><span class="p">,</span> <span class="n">TransitionCommand</span>
<span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Routine put command.&quot;&quot;&quot;</span>

    <span class="nb">id</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>  <span class="c1"># routine_id</span>
    <span class="n">scene</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>  <span class="c1"># scene_id</span>
    <span class="n">commands</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>  <span class="c1"># routine_commands</span>

    <span class="k">def</span> <span class="nf">__post_init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">__post_init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">action</span> <span class="o">=</span> <span class="n">RoutineAction</span><span class="o">.</span><span class="n">PUT</span><span class="o">.</span><span class="n">value</span>

<div class="viewcode-block" id="RoutinePutCommand.check_values"><a class="viewcode-back" href="../../../../klyqa_ctl.devices.light.html#klyqa_ctl.devices.light.commands.RoutinePutCommand.check_values">[docs]</a>    <span class="k">def</span> <span class="nf">check_values</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">device</span><span class="p">:</span> <span class="n">Device</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Check device scene support.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">device</span><span class="o">.</span><span class="n">ident</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">scene_result</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[</span>
                <span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">SCENES</span> <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">scene</span><span class="p">)</span>
            <span class="p">]</span>
            <span class="n">scene</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="n">scene_result</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

            <span class="c1"># bulb has no colors, therefore only cwww scenes are allowed</span>
            <span class="k">if</span> <span class="s2">&quot;.rgb&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">device</span><span class="o">.</span><span class="n">ident</span><span class="o">.</span><span class="n">product_id</span> <span class="ow">and</span> <span class="s2">&quot;cwww&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">scene</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">forced_continue</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_force</span><span class="p">,</span>
                    <span class="sa">f</span><span class="s2">&quot;Scene </span><span class="si">{</span><span class="n">scene</span><span class="p">[</span><span class="s1">&#39;label&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> not supported by device product&quot;</span>
                    <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">device</span><span class="o">.</span><span class="n">acc_sets</span><span class="p">[</span><span class="s1">&#39;productId&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">. Coldwhite/Warmwhite&quot;</span>
                    <span class="s2">&quot; Scenes only.&quot;</span><span class="p">,</span>
                <span class="p">)</span>

        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="k">return</span> <span class="ow">not</span> <span class="n">missing_config</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_force</span><span class="p">,</span> <span class="n">device</span><span class="o">.</span><span class="n">ident</span><span class="o">.</span><span class="n">product_id</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">True</span></div></div>


<div class="viewcode-block" id="percent_color_message"><a class="viewcode-back" href="../../../../klyqa_ctl.devices.light.html#klyqa_ctl.devices.light.commands.percent_color_message">[docs]</a><span class="k">def</span> <span class="nf">percent_color_message</span><span class="p">(</span>
    <span class="n">red</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">green</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">blue</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">warm</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">cold</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">transition_time</span><span class="p">:</span> <span class="nb">int</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]:</span>
    <span class="sd">&quot;&quot;&quot;Create message for color change in percent.&quot;&quot;&quot;</span>

    <span class="k">return</span> <span class="p">(</span>
        <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span>
            <span class="p">{</span>
                <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;request&quot;</span><span class="p">,</span>
                <span class="s2">&quot;p_color&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="s2">&quot;red&quot;</span><span class="p">:</span> <span class="n">red</span><span class="p">,</span>
                    <span class="s2">&quot;green&quot;</span><span class="p">:</span> <span class="n">green</span><span class="p">,</span>
                    <span class="s2">&quot;blue&quot;</span><span class="p">:</span> <span class="n">blue</span><span class="p">,</span>
                    <span class="s2">&quot;warm&quot;</span><span class="p">:</span> <span class="n">warm</span><span class="p">,</span>
                    <span class="s2">&quot;cold&quot;</span><span class="p">:</span> <span class="n">cold</span><span class="p">,</span>
                    <span class="c1"># &quot;brightness&quot; : brightness</span>
                <span class="p">},</span>
                <span class="s2">&quot;transitionTime&quot;</span><span class="p">:</span> <span class="n">transition_time</span><span class="p">,</span>
            <span class="p">}</span>
        <span class="p">),</span>
        <span class="n">transition_time</span><span class="p">,</span>
    <span class="p">)</span></div>


<div class="viewcode-block" id="external_source_message"><a class="viewcode-back" href="../../../../klyqa_ctl.devices.light.html#klyqa_ctl.devices.light.commands.external_source_message">[docs]</a><span class="k">def</span> <span class="nf">external_source_message</span><span class="p">(</span>
    <span class="n">protocol</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">port</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">channel</span><span class="p">:</span> <span class="nb">int</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">TypeJson</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Create external source protocol message.&quot;&quot;&quot;</span>

    <span class="n">protocol_str</span><span class="p">:</span> <span class="nb">str</span>
    <span class="k">if</span> <span class="n">protocol</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">protocol_str</span> <span class="o">=</span> <span class="s2">&quot;EXT_OFF&quot;</span>
    <span class="k">elif</span> <span class="n">protocol</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">protocol_str</span> <span class="o">=</span> <span class="s2">&quot;EXT_UDP&quot;</span>
    <span class="k">elif</span> <span class="n">protocol</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="n">protocol_str</span> <span class="o">=</span> <span class="s2">&quot;EXT_E131&quot;</span>
    <span class="k">elif</span> <span class="n">protocol</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
        <span class="n">protocol_str</span> <span class="o">=</span> <span class="s2">&quot;EXT_TPM2&quot;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">protocol_str</span> <span class="o">=</span> <span class="s2">&quot;EXT_OFF&quot;</span>
    <span class="k">return</span> <span class="p">{</span>
        <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;request&quot;</span><span class="p">,</span>
        <span class="s2">&quot;external&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;mode&quot;</span><span class="p">:</span> <span class="n">protocol_str</span><span class="p">,</span>
            <span class="s2">&quot;port&quot;</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="n">port</span><span class="p">),</span>
            <span class="s2">&quot;channel&quot;</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="n">channel</span><span class="p">),</span>
        <span class="p">},</span>
    <span class="p">}</span></div>


<div class="viewcode-block" id="add_command_args_bulb"><a class="viewcode-back" href="../../../../klyqa_ctl.devices.light.html#klyqa_ctl.devices.light.commands.add_command_args_bulb">[docs]</a><span class="k">def</span> <span class="nf">add_command_args_bulb</span><span class="p">(</span><span class="n">parser</span><span class="p">:</span> <span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentParser</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Add arguments to the argument parser object.</span>

<span class="sd">    Args:</span>
<span class="sd">        parser: Parser object</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s2">&quot;--transitionTime&quot;</span><span class="p">,</span>
        <span class="n">nargs</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;transition time in milliseconds&quot;</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
    <span class="p">)</span>

    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s2">&quot;--color&quot;</span><span class="p">,</span> <span class="n">nargs</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;set color command (r,g,b) 0-255&quot;</span>
    <span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s2">&quot;--temperature&quot;</span><span class="p">,</span>
        <span class="n">nargs</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="p">(</span>
            <span class="s2">&quot;set temperature command (in kelvin, range depends on lamp&quot;</span>
            <span class="s2">&quot; profile) (lower: warm, higher: cold)&quot;</span>
        <span class="p">),</span>
    <span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s2">&quot;--brightness&quot;</span><span class="p">,</span> <span class="n">nargs</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;set brightness in percent 0-100&quot;</span>
    <span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s2">&quot;--percent_color&quot;</span><span class="p">,</span>
        <span class="n">nargs</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
        <span class="n">metavar</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;RED&quot;</span><span class="p">,</span> <span class="s2">&quot;GREEN&quot;</span><span class="p">,</span> <span class="s2">&quot;BLUE&quot;</span><span class="p">,</span> <span class="s2">&quot;WARM&quot;</span><span class="p">,</span> <span class="s2">&quot;COLD&quot;</span><span class="p">),</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;set colors and white tones in percent 0 - 100&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;--ota&quot;</span><span class="p">,</span> <span class="n">nargs</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;specify http URL for ota&quot;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s2">&quot;--ping&quot;</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;send ping&quot;</span><span class="p">,</span>
        <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_const&quot;</span><span class="p">,</span>
        <span class="n">const</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s2">&quot;--request&quot;</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;send status request&quot;</span><span class="p">,</span>
        <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_const&quot;</span><span class="p">,</span>
        <span class="n">const</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="c1"># TODO: currently not fully implemented</span>
    <span class="c1"># parser.add_argument(</span>
    <span class="c1">#     &quot;--identity&quot;,</span>
    <span class="c1">#     help=&quot;send status request&quot;,</span>
    <span class="c1">#     action=&quot;store_const&quot;,</span>
    <span class="c1">#     const=True,</span>
    <span class="c1">#     default=False,</span>
    <span class="c1"># )</span>

    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s2">&quot;--factory_reset&quot;</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="p">(</span>
            <span class="s2">&quot;trigger a factory reset on the device (Warning: device has to be&quot;</span>
            <span class="s2">&quot; onboarded again afterwards)&quot;</span>
        <span class="p">),</span>
        <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_const&quot;</span><span class="p">,</span>
        <span class="n">const</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s2">&quot;--routine_list&quot;</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;lists stored routines&quot;</span><span class="p">,</span>
        <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_const&quot;</span><span class="p">,</span>
        <span class="n">const</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s2">&quot;--routine_put&quot;</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;store new routine&quot;</span><span class="p">,</span>
        <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_const&quot;</span><span class="p">,</span>
        <span class="n">const</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s2">&quot;--routine_delete&quot;</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;delete routine&quot;</span><span class="p">,</span>
        <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_const&quot;</span><span class="p">,</span>
        <span class="n">const</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s2">&quot;--routine_start&quot;</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;start routine&quot;</span><span class="p">,</span>
        <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_const&quot;</span><span class="p">,</span>
        <span class="n">const</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s2">&quot;--routine_id&quot;</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;specify routine id to act on (for put, start, delete)&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s2">&quot;--routine_scene&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;specify routine scene label (for put)&quot;</span>
    <span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s2">&quot;--routine_commands&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;specify routine program (for put)&quot;</span>
    <span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s2">&quot;--reboot&quot;</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;trigger a reboot&quot;</span><span class="p">,</span>
        <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_const&quot;</span><span class="p">,</span>
        <span class="n">const</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s2">&quot;--power&quot;</span><span class="p">,</span> <span class="n">nargs</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">metavar</span><span class="o">=</span><span class="s1">&#39;&quot;on&quot;/&quot;off&quot;&#39;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;turns the bulb on/off&quot;</span>
    <span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s2">&quot;--enable_tb&quot;</span><span class="p">,</span> <span class="n">nargs</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;enable thingsboard connection (yes/no)&quot;</span>
    <span class="p">)</span>

    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s2">&quot;--fade&quot;</span><span class="p">,</span>
        <span class="n">nargs</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;fade in/out time in milliseconds on powering device on/off&quot;</span><span class="p">,</span>
        <span class="n">metavar</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;IN&quot;</span><span class="p">,</span> <span class="s2">&quot;OUT&quot;</span><span class="p">),</span>
    <span class="p">)</span>

    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s2">&quot;--external_source&quot;</span><span class="p">,</span>
        <span class="n">nargs</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
        <span class="n">metavar</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;MODE&quot;</span><span class="p">,</span> <span class="s2">&quot;PORT&quot;</span><span class="p">,</span> <span class="s2">&quot;CHANNEL&quot;</span><span class="p">),</span>
        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;set external protocol receiver 0=OFF 1=RAWUDP 2=E131 2=TMP2&quot;</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="c1"># parser.add_argument(&quot;--loop&quot;, help=&quot;loop&quot;, action=&quot;store_true&quot;)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;--WW&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Warm White&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;--daylight&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;daylight&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;--CW&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Cold White&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;--nightlight&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;nightlight&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;--relax&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;relax&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;--TVtime&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;TVtime&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;--comfort&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;comfort&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;--focused&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;focused&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;--fireplace&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;fireplace&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;--club&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;club&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;--romantic&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;romantic&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;--gentle&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;gentle&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;--summer&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;summer&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;--jungle&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;jungle&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;--ocean&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;ocean&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;--fall&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;fall&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;--sunset&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;sunset&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;--party&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;party&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;--spring&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;spring&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;--forest&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;forest&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;--deep_sea&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;deep_sea&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;--tropical&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;tropical&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;--magic&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;magic Mood&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
        <span class="s2">&quot;--mystic&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Mystic Mountain&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span>
    <span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;--cotton&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Cotton Candy&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;--ice&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Ice Cream&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="discover_devices"><a class="viewcode-back" href="../../../../klyqa_ctl.devices.light.html#klyqa_ctl.devices.light.commands.discover_devices">[docs]</a><span class="k">async</span> <span class="k">def</span> <span class="nf">discover_devices</span><span class="p">(</span>
    <span class="n">args</span><span class="p">:</span> <span class="n">argparse</span><span class="o">.</span><span class="n">Namespace</span><span class="p">,</span>
    <span class="n">args_in</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Any</span><span class="p">],</span>
    <span class="n">send_to_devices_cb</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="n">argparse</span><span class="o">.</span><span class="n">Namespace</span><span class="p">],</span> <span class="n">Any</span><span class="p">],</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">argparse</span><span class="o">.</span><span class="n">Namespace</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>

    <span class="sd">&quot;&quot;&quot;Send out klyqa broadcast to discover all devices. Tries to set</span>
<span class="sd">    device_unitids in args parse. The user can select them.</span>

<span class="sd">    Params:</span>
<span class="sd">        args (Argsparse): Parsed args object</span>
<span class="sd">        args_in (list): List of arguments parsed to the script call</span>
<span class="sd">        timeout_ms (int, optional): Timeout to send. Defaults to 5000.</span>

<span class="sd">    Raises:</span>
<span class="sd">        Exception: Network or file errors</span>

<span class="sd">    Returns:</span>
<span class="sd">        bool: True if succeeded.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">discover_local_args</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">DeviceType</span><span class="o">.</span><span class="n">LIGHTING</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
        <span class="s2">&quot;--request&quot;</span><span class="p">,</span>
        <span class="s2">&quot;--allDevices&quot;</span><span class="p">,</span>
        <span class="s2">&quot;--selectDevice&quot;</span><span class="p">,</span>
        <span class="s2">&quot;--discover&quot;</span><span class="p">,</span>
    <span class="p">]</span>

    <span class="n">orginal_args_parser</span><span class="p">:</span> <span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentParser</span> <span class="o">=</span> <span class="n">get_description_parser</span><span class="p">()</span>
    <span class="n">discover_local_args_parser</span><span class="p">:</span> <span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentParser</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">get_description_parser</span><span class="p">()</span>
    <span class="p">)</span>

    <span class="n">add_config_args</span><span class="p">(</span><span class="n">parser</span><span class="o">=</span><span class="n">orginal_args_parser</span><span class="p">)</span>
    <span class="n">add_config_args</span><span class="p">(</span><span class="n">parser</span><span class="o">=</span><span class="n">discover_local_args_parser</span><span class="p">)</span>
    <span class="n">add_command_args_bulb</span><span class="p">(</span><span class="n">parser</span><span class="o">=</span><span class="n">discover_local_args_parser</span><span class="p">)</span>

    <span class="n">original_config_args_parsed</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">orginal_args_parser</span><span class="o">.</span><span class="n">parse_known_args</span><span class="p">(</span>
        <span class="n">args</span><span class="o">=</span><span class="n">args_in</span>
    <span class="p">)</span>

    <span class="n">discover_local_args_parsed</span> <span class="o">=</span> <span class="n">discover_local_args_parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">(</span>
        <span class="n">discover_local_args</span><span class="p">,</span> <span class="n">namespace</span><span class="o">=</span><span class="n">original_config_args_parsed</span>
    <span class="p">)</span>

    <span class="n">uids</span><span class="p">:</span> <span class="nb">set</span> <span class="o">|</span> <span class="nb">list</span> <span class="o">|</span> <span class="nb">str</span> <span class="o">=</span> <span class="k">await</span> <span class="n">send_to_devices_cb</span><span class="p">(</span>
        <span class="n">discover_local_args_parsed</span>
    <span class="p">)</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">uids</span><span class="p">,</span> <span class="nb">set</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">uids</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
        <span class="n">args_in</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;--device_unitids&quot;</span><span class="p">,</span> <span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">uids</span><span class="p">))]</span> <span class="o">+</span> <span class="n">args_in</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">uids</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">and</span> <span class="n">uids</span> <span class="o">==</span> <span class="s2">&quot;no_devices&quot;</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">None</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">LOGGER</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Error during local discovery of the devices.&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="n">add_command_args_bulb</span><span class="p">(</span><span class="n">parser</span><span class="o">=</span><span class="n">orginal_args_parser</span><span class="p">)</span>
    <span class="n">args</span> <span class="o">=</span> <span class="n">orginal_args_parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">(</span><span class="n">args</span><span class="o">=</span><span class="n">args_in</span><span class="p">,</span> <span class="n">namespace</span><span class="o">=</span><span class="n">args</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">args</span></div>


<div class="viewcode-block" id="add_device_command_to_queue"><a class="viewcode-back" href="../../../../klyqa_ctl.devices.light.html#klyqa_ctl.devices.light.commands.add_device_command_to_queue">[docs]</a><span class="k">async</span> <span class="k">def</span> <span class="nf">add_device_command_to_queue</span><span class="p">(</span>
    <span class="n">args</span><span class="p">:</span> <span class="n">argparse</span><span class="o">.</span><span class="n">Namespace</span><span class="p">,</span>
    <span class="n">args_in</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Any</span><span class="p">],</span>
    <span class="n">send_to_devices_callable</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="n">argparse</span><span class="o">.</span><span class="n">Namespace</span><span class="p">],</span> <span class="n">Any</span><span class="p">],</span>
    <span class="n">msg_queue</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Command</span><span class="p">],</span>
    <span class="c1"># message_queue_tx_command_cloud: list[Any],</span>
    <span class="c1"># message_queue_tx_state_cloud: list[Any],</span>
    <span class="n">scene_list</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">    Process arguments for communicating with lights. Fill message queues for</span>
<span class="sd">    local and cloud communication. Discover devices to communicate with.</span>

<span class="sd">    Params:</span>
<span class="sd">        args: Parsed arguments to be processed.</span>
<span class="sd">        args_in: Original arguments as a list, if we want to reparse and add</span>
<span class="sd">            arguments.</span>
<span class="sd">        send_to_devices_callable: If we need to send something to the lamps,</span>
<span class="sd">            use this callable.</span>
<span class="sd">        message_queue_tx_local: Queue to be filled with messages for local</span>
<span class="sd">            communication.</span>
<span class="sd">        message_queue_tx_command_cloud: Queue for cloud command messages.</span>
<span class="sd">        message_queue_tx_state_cloud: Queue for cloud state messages.</span>
<span class="sd">        scene_list: If a scene is applied, add it to the scene list, so the</span>
<span class="sd">            klyqa-ctl send function can process it.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># needs rewrite</span>
    <span class="c1">## TODO: Missing cloud discovery and interactive device selection. Send to</span>
    <span class="c1">## devices if given as argument working.</span>
    <span class="c1"># if (args.local or args.tryLocalThanCloud) and (</span>
    <span class="c1">#     not args.device_name</span>
    <span class="c1">#     and not args.device_unitids</span>
    <span class="c1">#     and not args.allDevices</span>
    <span class="c1">#     and not args.discover</span>
    <span class="c1"># ):</span>
    <span class="c1">#     args_ret: argparse.Namespace | None = await self.discover_devices(</span>
    <span class="c1">#         args, args_in, send_to_devices_callable</span>
    <span class="c1">#     )</span>

    <span class="c1">#     if isinstance(args_ret, argparse.Namespace):</span>
    <span class="c1">#         args = args_ret</span>

    <span class="n">commands_to_send</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">COMMANDS_TO_SEND</span> <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
    <span class="p">]</span>

    <span class="k">if</span> <span class="n">commands_to_send</span><span class="p">:</span>
        <span class="n">LOGGER</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
            <span class="s2">&quot;Commands to send to devices: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">commands_to_send</span><span class="p">)</span>
        <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="k">await</span> <span class="n">commands_select</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="n">args_in</span><span class="p">,</span> <span class="n">send_to_devices_callable</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">False</span>

    <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">ota</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">msg_queue</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">FwUpdateCommand</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">ota</span><span class="p">))</span>

    <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">ping</span><span class="p">:</span>
        <span class="n">msg_queue</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">PingCommand</span><span class="p">())</span>

    <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">request</span><span class="p">:</span>
        <span class="n">msg_queue</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">RequestCommand</span><span class="p">())</span>

    <span class="c1"># needs new command class</span>
    <span class="c1"># if args.external_source:</span>
    <span class="c1">#     mode, port, channel = args.external_source</span>
    <span class="c1">#     message_queue_tx_local.append(</span>
    <span class="c1">#         # ExternalSourceCommand(protocol=, port=int(port),</span>
    <span class="c1"># channel=int(channel)).json()</span>
    <span class="c1">#         external_source_message(int(mode), port, channel)</span>
    <span class="c1">#         , 0</span>
    <span class="c1">#     )</span>

    <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">enable_tb</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">enable_tb</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="n">msg_queue</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">passive</span><span class="p">:</span>
        <span class="k">pass</span>

    <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">power</span><span class="p">:</span>
        <span class="n">msg_queue</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="n">PowerCommand</span><span class="p">(</span><span class="n">status</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">power</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="c1"># Command(_json={&quot;type&quot;: &quot;request&quot;, &quot;status&quot;: args.power[0]})</span>
        <span class="p">)</span>

    <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">color</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">command_color</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="n">msg_queue</span><span class="p">)</span>

    <span class="c1"># if args.percent_color is not None:</span>
    <span class="c1">#     command_color_percent(args, msg_queue)</span>

    <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">temperature</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">msg_queue</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="n">TemperatureCommand</span><span class="p">(</span>
                <span class="n">transition_time</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">transitionTime</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                <span class="n">_force</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">force</span><span class="p">,</span>
                <span class="n">temperature</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">temperature</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
            <span class="p">)</span>
        <span class="p">)</span>

    <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">brightness</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">command_brightness</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="n">msg_queue</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">factory_reset</span><span class="p">:</span>
        <span class="n">msg_queue</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="n">FactoryResetCommand</span><span class="p">()</span>
            <span class="c1"># Command(_json={&quot;type&quot;: &quot;factory_reset&quot;, &quot;status&quot;: args.power[0]})</span>
        <span class="p">)</span>

    <span class="c1"># needs new command classes</span>
    <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">fade</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">fade</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="c1">#     message_queue_tx_local.append(</span>
        <span class="c1">#         {&quot;type&quot;: &quot;request&quot;, &quot;fade_out&quot;: args.fade[1],</span>
        <span class="c1"># &quot;fade_in&quot;: args.fade[0]}, 500</span>
        <span class="c1">#     )</span>
        <span class="n">msg_queue</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="n">FadeCommand</span><span class="p">(</span><span class="n">fade_in</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">fade</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">fade_out</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">fade</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="c1"># Command(</span>
            <span class="c1">#     _json={</span>
            <span class="c1">#         &quot;type&quot;: &quot;request&quot;,</span>
            <span class="c1">#         &quot;fade_out&quot;: args.fade[1],</span>
            <span class="c1">#         &quot;fade_in&quot;: args.fade[0],</span>
            <span class="c1">#     }</span>
            <span class="c1"># )</span>
        <span class="p">)</span>

    <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">reboot</span><span class="p">:</span>
        <span class="c1"># message_queue_tx_local.append(Command(_json={&quot;type&quot;: &quot;reboot&quot;}))</span>
        <span class="n">msg_queue</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">RebootCommand</span><span class="p">())</span>

    <span class="n">routine_scene</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="n">scene_list</span><span class="p">)</span>
    <span class="c1"># return False</span>

    <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">routine_list</span><span class="p">:</span>
        <span class="c1"># message_queue_tx_local.append({&quot;type&quot;: &quot;routine&quot;, &quot;action&quot;: &quot;list&quot;},</span>
        <span class="c1"># 500)</span>
        <span class="n">msg_queue</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="c1"># Command(_json={&quot;type&quot;: &quot;routine&quot;, &quot;action&quot;: &quot;list&quot;})</span>
            <span class="n">RoutineListCommand</span><span class="p">()</span>
        <span class="p">)</span>

    <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">routine_put</span> <span class="ow">and</span> <span class="n">args</span><span class="o">.</span><span class="n">routine_id</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">msg_queue</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="n">RoutinePutCommand</span><span class="p">(</span>
                <span class="nb">id</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">routine_id</span><span class="p">,</span>
                <span class="n">scene</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">routine_scene</span><span class="p">,</span>
                <span class="n">commands</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">routine_commands</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="p">)</span>

    <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">routine_delete</span> <span class="ow">and</span> <span class="n">args</span><span class="o">.</span><span class="n">routine_id</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">msg_queue</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="n">RoutineDeleteCommand</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">routine_id</span><span class="p">)</span>
            <span class="c1"># {&quot;type&quot;: &quot;routine&quot;, &quot;action&quot;: &quot;delete&quot;, &quot;id&quot;: args.routine_id},</span>
            <span class="c1"># 500</span>
        <span class="p">)</span>
    <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">routine_start</span> <span class="ow">and</span> <span class="n">args</span><span class="o">.</span><span class="n">routine_id</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">msg_queue</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="n">RoutineStartCommand</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">routine_id</span><span class="p">)</span>
            <span class="c1"># {&quot;type&quot;: &quot;routine&quot;, &quot;action&quot;: &quot;start&quot;, &quot;id&quot;: args.routine_id},</span>
            <span class="c1"># 500</span>
        <span class="p">)</span>

    <span class="k">return</span> <span class="kc">True</span></div>


<span class="c1"># Needs clean up</span>
<div class="viewcode-block" id="commands_select"><a class="viewcode-back" href="../../../../klyqa_ctl.devices.light.html#klyqa_ctl.devices.light.commands.commands_select">[docs]</a><span class="k">async</span> <span class="k">def</span> <span class="nf">commands_select</span><span class="p">(</span>
    <span class="n">args</span><span class="p">:</span> <span class="n">argparse</span><span class="o">.</span><span class="n">Namespace</span><span class="p">,</span>
    <span class="n">args_in</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
    <span class="n">send_to_devices_callable</span><span class="p">:</span> <span class="n">Callable</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Interactive command select.&quot;&quot;&quot;</span>
    <span class="c1"># print(&quot;Commands (arguments):&quot;)</span>
    <span class="c1"># print(sep_width * &quot;-&quot;)</span>

    <span class="c1"># def get_temp_range(product_id: str) -&gt; bool | tuple[int,int]:</span>
    <span class="c1">#     temperature_enum = []</span>
    <span class="c1">#     if not self.device_config:</span>
    <span class="c1">#         return False</span>
    <span class="c1">#     try:</span>
    <span class="c1">#         temperature_enum = [</span>
    <span class="c1">#             trait[&quot;value_schema&quot;][&quot;properties&quot;][&quot;colorTemperature&quot;][&quot;enum&quot;]</span>
    <span class="c1">#             if &quot;properties&quot; in trait[&quot;value_schema&quot;]</span>
    <span class="c1">#             else trait[&quot;value_schema&quot;][&quot;enum&quot;]</span>
    <span class="c1">#             for trait in self.device_config[&quot;deviceTraits&quot;]</span>
    <span class="c1">#             if trait[&quot;trait&quot;] == &quot;@core/traits/color-temperature&quot;</span>
    <span class="c1">#         ]</span>
    <span class="c1">#         if len(temperature_enum[0]) &lt; 2:</span>
    <span class="c1">#             raise Exception()</span>
    <span class="c1">#     except:</span>
    <span class="c1">#         return False</span>
    <span class="c1">#     return temperature_enum[0]</span>

    <span class="c1"># def get_inner_range(tup1: Any, tup2: Any) -&gt; tuple[int, int]:</span>
    <span class="c1">#     return (</span>
    <span class="c1">#         tup1[0] if tup1[0] &gt; tup2[0] else tup2[0],</span>
    <span class="c1">#         tup1[1] if tup1[1] &lt; tup2[1] else tup2[1],</span>
    <span class="c1">#     )</span>

    <span class="c1"># temperature_enum: tuple[int, int] = tuple()</span>
    <span class="c1"># color: list[int] = [0, 255]</span>
    <span class="c1"># brightness: tuple[int, int] = (0,100)</span>
    <span class="c1"># u_id: str</span>
    <span class="c1"># for u_id in args.device_unitids[0].split(&quot;,&quot;):</span>
    <span class="c1">#     u_id = format_uid(u_id)</span>
    <span class="c1">#     # fix self devices</span>
    <span class="c1">#     if u_id not in self.devices or not self.devices[u_id].ident:</span>

    <span class="c1">#         async def send_ping() -&gt; bool:</span>
    <span class="c1">#             discover_local_args2: list[str] = [</span>
    <span class="c1">#                 &quot;--ping&quot;,</span>
    <span class="c1">#                 &quot;--device_unitids&quot;,</span>
    <span class="c1">#                 u_id,</span>
    <span class="c1">#             ]</span>

    <span class="c1">#             orginal_args_parser: argparse.ArgumentParser = (</span>
    <span class="c1">#                 get_description_parser()</span>
    <span class="c1">#             )</span>
    <span class="c1">#             discover_local_args_parser2: argparse.ArgumentParser = (</span>
    <span class="c1">#                 get_description_parser()</span>
    <span class="c1">#             )</span>

    <span class="c1">#             add_config_args(parser=orginal_args_parser)</span>
    <span class="c1">#             add_config_args(parser=discover_local_args_parser2)</span>
    <span class="c1">#             add_command_args_bulb(parser=discover_local_args_parser2)</span>

    <span class="c1">#             (</span>
    <span class="c1">#                 original_config_args_parsed,</span>
    <span class="c1">#                 _,</span>
    <span class="c1">#             ) = orginal_args_parser.parse_known_args(args=args_in)</span>

    <span class="c1">#             discover_local_args_parsed2 = (</span>
    <span class="c1">#                 discover_local_args_parser2.parse_args(</span>
    <span class="c1">#                     discover_local_args2,</span>
    <span class="c1">#                     namespace=original_config_args_parsed,</span>
    <span class="c1">#                 )</span>
    <span class="c1">#             )</span>

    <span class="c1">#             ret = send_to_devices_callable(discover_local_args_parsed2)</span>
    <span class="c1">#             if isinstance(ret, bool) and ret:</span>
    <span class="c1">#                 return True</span>
    <span class="c1">#             else:</span>
    <span class="c1">#                 return False</span>

    <span class="c1">#         ret: bool = await send_ping()</span>
    <span class="c1">#         if isinstance(ret, bool) and ret:</span>
    <span class="c1">#             product_id: str = self.devices[u_id].ident.product_id</span>
    <span class="c1">#         else:</span>
    <span class="c1">#             LOGGER.error(f&quot;Device {u_id} not found.&quot;)</span>
    <span class="c1">#             return False</span>
    <span class="c1">#     product_id = self.devices[u_id].ident.product_id</span>
    <span class="c1">#     if not temperature_enum:</span>
    <span class="c1">#         temperature_enum = get_temp_range(product_id)</span>
    <span class="c1">#     else:</span>
    <span class="c1">#         temperature_enum = get_inner_range(</span>
    <span class="c1">#             temperature_enum, get_temp_range(product_id)</span>
    <span class="c1">#         )</span>
    <span class="c1"># arguments_send_to_device = {}</span>
    <span class="c1"># if temperature_enum:</span>
    <span class="c1">#     arguments_send_to_device = {</span>
    <span class="c1">#         &quot;temperature&quot;: &quot; [&quot;</span>
    <span class="c1">#         + str(temperature_enum[0])</span>
    <span class="c1">#         + &quot;-&quot;</span>
    <span class="c1">#         + str(temperature_enum[1])</span>
    <span class="c1">#         + &quot;] (Kelvin, low: warm, high: cold)&quot;</span>
    <span class="c1">#     }</span>

    <span class="c1"># arguments_send_to_device: dict[str, str] = {</span>
    <span class="c1">#     **arguments_send_to_device,</span>
    <span class="c1">#     **{</span>
    <span class="c1">#         &quot;color&quot;: f&quot; rgb [{color[0]}..{color[1]}] [{color[0]}..{color[1]}]</span>
    <span class="c1"># [{color[0]}..{color[1]}]&quot;,</span>
    <span class="c1">#         &quot;brightness&quot;: &quot; [&quot;</span>
    <span class="c1">#         + str(brightness[0])</span>
    <span class="c1">#         + &quot;..&quot;</span>
    <span class="c1">#         + str(brightness[1])</span>
    <span class="c1">#         + &quot;]&quot;,</span>
    <span class="c1">#         &quot;routine_commands&quot;: &quot; [cmd]&quot;,</span>
    <span class="c1">#         &quot;routine_id&quot;: &quot; [int]&quot;,</span>
    <span class="c1">#         &quot;power&quot;: &quot; [on/off]&quot;,</span>
    <span class="c1">#     },</span>
    <span class="c1"># }</span>

    <span class="c1"># count: int = 1</span>
    <span class="c1"># for c in commands_send_to_bulb:</span>
    <span class="c1">#     args_to_b: str = (</span>
    <span class="c1">#         arguments_send_to_device[c] if c in arguments_send_to_device</span>
    <span class="c1"># else &quot;&quot;</span>
    <span class="c1">#     )</span>
    <span class="c1">#     LOGGER.info(str(count) + &quot;) &quot; + c + args_to_b)</span>
    <span class="c1">#     count = count + 1</span>

    <span class="c1"># cmd_c_id: int = int(input(&quot;Choose command number [1-9]*: &quot;))</span>
    <span class="c1"># if cmd_c_id &gt; 0 and cmd_c_id &lt; count:</span>
    <span class="c1">#     args_in.append(&quot;--&quot; + commands_send_to_bulb[cmd_c_id - 1])</span>
    <span class="c1"># else:</span>
    <span class="c1">#     LOGGER.error(&quot;No such command id &quot; + str(cmd_c_id) + &quot; available.&quot;)</span>
    <span class="c1">#     sys.exit(1)</span>

    <span class="c1"># if commands_send_to_bulb[cmd_c_id - 1] in arguments_send_to_device:</span>
    <span class="c1">#     args_app: str = input(</span>
    <span class="c1">#         &quot;Set arguments (multiple arguments space separated) for command</span>
    <span class="c1"># [Enter]: &quot;</span>
    <span class="c1">#     )</span>
    <span class="c1">#     if args_app:</span>
    <span class="c1">#         args_in.extend(args_app.split(&quot; &quot;))</span>

    <span class="c1"># parser: argparse.ArgumentParser = get_description_parser()</span>

    <span class="c1"># add_config_args(parser=parser)</span>
    <span class="c1"># add_command_args_bulb(parser=parser)</span>

    <span class="c1"># args = parser.parse_args(args_in, namespace=args)</span>
    <span class="c1"># # args.func(args)</span>
    <span class="k">return</span> <span class="kc">True</span></div>


<div class="viewcode-block" id="command_color"><a class="viewcode-back" href="../../../../klyqa_ctl.devices.light.html#klyqa_ctl.devices.light.commands.command_color">[docs]</a><span class="k">def</span> <span class="nf">command_color</span><span class="p">(</span>
    <span class="n">args</span><span class="p">:</span> <span class="n">argparse</span><span class="o">.</span><span class="n">Namespace</span><span class="p">,</span>
    <span class="n">msg_queue</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Command</span><span class="p">],</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Command for setting the color.&quot;&quot;&quot;</span>
    <span class="n">r</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">g</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">b</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">r</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">color</span>

    <span class="n">tt</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">transitionTime</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">msg</span><span class="p">:</span> <span class="n">ColorCommand</span> <span class="o">=</span> <span class="n">ColorCommand</span><span class="p">(</span>
        <span class="n">transition_time</span><span class="o">=</span><span class="n">tt</span><span class="p">,</span>
        <span class="n">_force</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">force</span><span class="p">,</span>
        <span class="n">color</span><span class="o">=</span><span class="n">RgbColor</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">r</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="n">g</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="n">b</span><span class="p">)),</span>
    <span class="p">)</span>

    <span class="n">msg_queue</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span></div>


<span class="c1"># def command_color_percent(</span>
<span class="c1">#     args: argparse.Namespace,</span>
<span class="c1">#     msg_queue: list[Command],</span>
<span class="c1"># ) -&gt; None:</span>
<span class="c1">#     &quot;&quot;&quot;Command for color in percentage numbers.&quot;&quot;&quot;</span>
<span class="c1">#     r: Any</span>
<span class="c1">#     g: Any</span>
<span class="c1">#     b: Any</span>
<span class="c1">#     w: Any</span>
<span class="c1">#     c: Any</span>
<span class="c1">#     r, g, b, w, c = args.percent_color</span>
<span class="c1">#     tt: Any = args.transitionTime[0]</span>
<span class="c1">#     msg: tuple[str, int] = percent_color_message(</span>
<span class="c1">#         r, g, b, w, c, 0 if args.brightness is not None else tt</span>
<span class="c1">#     )</span>
<span class="c1">#     msg_queue.append(msg)</span>


<div class="viewcode-block" id="command_brightness"><a class="viewcode-back" href="../../../../klyqa_ctl.devices.light.html#klyqa_ctl.devices.light.commands.command_brightness">[docs]</a><span class="k">def</span> <span class="nf">command_brightness</span><span class="p">(</span>
    <span class="n">args</span><span class="p">:</span> <span class="n">argparse</span><span class="o">.</span><span class="n">Namespace</span><span class="p">,</span>
    <span class="n">msg_queue</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Command</span><span class="p">],</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Command for brightness.&quot;&quot;&quot;</span>

    <span class="n">brightness_str</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">brightness</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="n">tt</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">transitionTime</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

    <span class="n">msg</span><span class="p">:</span> <span class="n">BrightnessCommand</span> <span class="o">=</span> <span class="n">BrightnessCommand</span><span class="p">(</span>
        <span class="n">transition_time</span><span class="o">=</span><span class="n">tt</span><span class="p">,</span>
        <span class="n">_force</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">force</span><span class="p">,</span>
        <span class="n">brightness</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">brightness_str</span><span class="p">),</span>
    <span class="p">)</span>

    <span class="n">msg_queue</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span></div>


<div class="viewcode-block" id="command_temperature"><a class="viewcode-back" href="../../../../klyqa_ctl.devices.light.html#klyqa_ctl.devices.light.commands.command_temperature">[docs]</a><span class="k">def</span> <span class="nf">command_temperature</span><span class="p">(</span>
    <span class="n">args</span><span class="p">:</span> <span class="n">argparse</span><span class="o">.</span><span class="n">Namespace</span><span class="p">,</span>
    <span class="n">msg_queue</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Command</span><span class="p">],</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Command for temperature.&quot;&quot;&quot;</span>

    <span class="n">temperature</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">temperature</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">tt</span><span class="p">:</span> <span class="n">Any</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">transitionTime</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="n">msg</span><span class="p">:</span> <span class="n">TemperatureCommand</span> <span class="o">=</span> <span class="n">TemperatureCommand</span><span class="p">(</span>
        <span class="n">transition_time</span><span class="o">=</span><span class="n">tt</span><span class="p">,</span>
        <span class="n">_force</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">force</span><span class="p">,</span>
        <span class="n">temperature</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">temperature</span><span class="p">),</span>
    <span class="p">)</span>

    <span class="n">msg_queue</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span></div>


<div class="viewcode-block" id="routine_scene"><a class="viewcode-back" href="../../../../klyqa_ctl.devices.light.html#klyqa_ctl.devices.light.commands.routine_scene">[docs]</a><span class="k">def</span> <span class="nf">routine_scene</span><span class="p">(</span><span class="n">args</span><span class="p">:</span> <span class="n">argparse</span><span class="o">.</span><span class="n">Namespace</span><span class="p">,</span> <span class="n">scene_list</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Command for select scene.&quot;&quot;&quot;</span>

    <span class="n">scene</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">WW</span><span class="p">:</span>
        <span class="n">scene</span> <span class="o">=</span> <span class="s2">&quot;Warm White&quot;</span>
    <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">daylight</span><span class="p">:</span>
        <span class="n">scene</span> <span class="o">=</span> <span class="s2">&quot;Daylight&quot;</span>
    <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">CW</span><span class="p">:</span>
        <span class="n">scene</span> <span class="o">=</span> <span class="s2">&quot;Cold White&quot;</span>
    <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">nightlight</span><span class="p">:</span>
        <span class="n">scene</span> <span class="o">=</span> <span class="s2">&quot;Night Light&quot;</span>
    <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">relax</span><span class="p">:</span>
        <span class="n">scene</span> <span class="o">=</span> <span class="s2">&quot;Relax&quot;</span>
    <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">TVtime</span><span class="p">:</span>
        <span class="n">scene</span> <span class="o">=</span> <span class="s2">&quot;TV time&quot;</span>
    <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">comfort</span><span class="p">:</span>
        <span class="n">scene</span> <span class="o">=</span> <span class="s2">&quot;Comfort&quot;</span>
    <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">focused</span><span class="p">:</span>
        <span class="n">scene</span> <span class="o">=</span> <span class="s2">&quot;Focused&quot;</span>
    <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">fireplace</span><span class="p">:</span>
        <span class="n">scene</span> <span class="o">=</span> <span class="s2">&quot;Fireplace&quot;</span>
    <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">club</span><span class="p">:</span>
        <span class="n">scene</span> <span class="o">=</span> <span class="s2">&quot;Jazz Club&quot;</span>
    <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">romantic</span><span class="p">:</span>
        <span class="n">scene</span> <span class="o">=</span> <span class="s2">&quot;Romantic&quot;</span>
    <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">gentle</span><span class="p">:</span>
        <span class="n">scene</span> <span class="o">=</span> <span class="s2">&quot;Gentle&quot;</span>
    <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">summer</span><span class="p">:</span>
        <span class="n">scene</span> <span class="o">=</span> <span class="s2">&quot;Summer&quot;</span>
    <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">jungle</span><span class="p">:</span>
        <span class="n">scene</span> <span class="o">=</span> <span class="s2">&quot;Jungle&quot;</span>
    <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">ocean</span><span class="p">:</span>
        <span class="n">scene</span> <span class="o">=</span> <span class="s2">&quot;Ocean&quot;</span>
    <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">fall</span><span class="p">:</span>  <span class="c1"># Autumn</span>
        <span class="n">scene</span> <span class="o">=</span> <span class="s2">&quot;Fall&quot;</span>
    <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">sunset</span><span class="p">:</span>
        <span class="n">scene</span> <span class="o">=</span> <span class="s2">&quot;Sunset&quot;</span>
    <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">party</span><span class="p">:</span>
        <span class="n">scene</span> <span class="o">=</span> <span class="s2">&quot;Party&quot;</span>
    <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">spring</span><span class="p">:</span>
        <span class="n">scene</span> <span class="o">=</span> <span class="s2">&quot;Spring&quot;</span>
    <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">forest</span><span class="p">:</span>
        <span class="n">scene</span> <span class="o">=</span> <span class="s2">&quot;Forest&quot;</span>
    <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">deep_sea</span><span class="p">:</span>
        <span class="n">scene</span> <span class="o">=</span> <span class="s2">&quot;Deep Sea&quot;</span>
    <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">tropical</span><span class="p">:</span>
        <span class="n">scene</span> <span class="o">=</span> <span class="s2">&quot;Tropical&quot;</span>
    <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">magic</span><span class="p">:</span>
        <span class="n">scene</span> <span class="o">=</span> <span class="s2">&quot;Magic Mood&quot;</span>
    <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">mystic</span><span class="p">:</span>
        <span class="n">scene</span> <span class="o">=</span> <span class="s2">&quot;Mystic Mountain&quot;</span>
    <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">cotton</span><span class="p">:</span>
        <span class="n">scene</span> <span class="o">=</span> <span class="s2">&quot;Cotton Candy&quot;</span>
    <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">ice</span><span class="p">:</span>
        <span class="n">scene</span> <span class="o">=</span> <span class="s2">&quot;Ice Cream&quot;</span>

    <span class="k">if</span> <span class="n">scene</span><span class="p">:</span>
        <span class="n">scene_result</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">SCENES</span> <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="s2">&quot;label&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">scene</span>
        <span class="p">]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">len</span><span class="p">(</span><span class="n">scene_result</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">scene_result</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">LOGGER</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
                <span class="s2">&quot;Scene </span><span class="si">%s</span><span class="s2"> not found or more than one scene with the name&quot;</span>
                <span class="s2">&quot; found.&quot;</span><span class="p">,</span>
                <span class="n">scene</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="n">scene_obj</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="n">scene_result</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="n">commands</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">scene_obj</span><span class="p">[</span><span class="s2">&quot;commands&quot;</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">commands</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;;&quot;</span><span class="p">))</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">commands</span> <span class="o">+=</span> <span class="s2">&quot;l 0;&quot;</span>
        <span class="n">args</span><span class="o">.</span><span class="n">routine_id</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">args</span><span class="o">.</span><span class="n">routine_put</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">args</span><span class="o">.</span><span class="n">routine_commands</span> <span class="o">=</span> <span class="n">commands</span>
        <span class="n">args</span><span class="o">.</span><span class="n">routine_scene</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">scene_obj</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">])</span>

        <span class="n">scene_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">scene</span><span class="p">)</span>

    <span class="k">return</span> <span class="kc">True</span></div>


<div class="viewcode-block" id="enable_tb"><a class="viewcode-back" href="../../../../klyqa_ctl.devices.light.html#klyqa_ctl.devices.light.commands.enable_tb">[docs]</a><span class="k">def</span> <span class="nf">enable_tb</span><span class="p">(</span><span class="n">args</span><span class="p">:</span> <span class="n">argparse</span><span class="o">.</span><span class="n">Namespace</span><span class="p">,</span> <span class="n">msg_queue</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Command</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Enable thingsboard to device.&quot;&quot;&quot;</span>

    <span class="n">a</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">enable_tb</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">a</span> <span class="o">!=</span> <span class="s2">&quot;yes&quot;</span> <span class="ow">and</span> <span class="n">a</span> <span class="o">!=</span> <span class="s2">&quot;no&quot;</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;ERROR --enable_tb needs to be yes or no&quot;</span><span class="p">)</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

    <span class="n">msg_queue</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Command</span><span class="p">({</span><span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;backend&quot;</span><span class="p">,</span> <span class="s2">&quot;link_enabled&quot;</span><span class="p">:</span> <span class="n">a</span><span class="p">}))</span></div>


<div class="viewcode-block" id="forced_continue"><a class="viewcode-back" href="../../../../klyqa_ctl.devices.light.html#klyqa_ctl.devices.light.commands.forced_continue">[docs]</a><span class="k">def</span> <span class="nf">forced_continue</span><span class="p">(</span><span class="n">force</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span> <span class="n">reason</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Force argument.&quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">force</span><span class="p">:</span>
        <span class="n">LOGGER</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">reason</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">False</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">LOGGER</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">reason</span><span class="p">)</span>
        <span class="n">LOGGER</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Enforced send&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">True</span></div>


<div class="viewcode-block" id="missing_config"><a class="viewcode-back" href="../../../../klyqa_ctl.devices.light.html#klyqa_ctl.devices.light.commands.missing_config">[docs]</a><span class="k">def</span> <span class="nf">missing_config</span><span class="p">(</span><span class="n">force</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span> <span class="n">product_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Missing device config.&quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">forced_continue</span><span class="p">(</span>
        <span class="n">force</span><span class="p">,</span>
        <span class="s2">&quot;Missing or faulty config values for device &quot;</span>
        <span class="o">+</span> <span class="s2">&quot; product_id: &quot;</span>
        <span class="o">+</span> <span class="n">product_id</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="k">return</span> <span class="kc">True</span>
    <span class="k">return</span> <span class="kc">False</span></div>
</pre></div>

          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../../../../index.html">klyqa_ctl</a></h1>








<h3>Navigation</h3>
<p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../klyqa_ctl.html">klyqa_ctl package</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../../../index.html">Documentation overview</a><ul>
  <li><a href="../../../index.html">Module code</a><ul>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2023, Author.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 6.1.3</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.13</a>
      
    </div>

    

    
  </body>
</html>