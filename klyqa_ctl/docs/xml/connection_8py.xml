<?xml version='1.0' encoding='UTF-8' standalone='no'?>
<doxygen xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="compound.xsd" version="1.9.1" xml:lang="en-US">
  <compounddef id="connection_8py" kind="file" language="Python">
    <compoundname>connection.py</compoundname>
    <innerclass refid="classlocal_1_1connection_1_1AesConnectionState" prot="public">local::connection::AesConnectionState</innerclass>
    <innerclass refid="classlocal_1_1connection_1_1DeviceTcpReturn" prot="public">local::connection::DeviceTcpReturn</innerclass>
    <innerclass refid="classlocal_1_1connection_1_1TcpConnection" prot="public">local::connection::TcpConnection</innerclass>
    <innernamespace refid="namespacelocal_1_1connection">local::connection</innernamespace>
    <briefdescription>
    </briefdescription>
    <detaileddescription>
    </detaileddescription>
    <programlisting>
<codeline lineno="1" refid="namespacelocal_1_1connection" refkind="compound"><highlight class="stringliteral">&quot;&quot;&quot;Local<sp/>connection<sp/>class&quot;&quot;&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2"><highlight class="normal"></highlight><highlight class="keyword">from</highlight><highlight class="normal"><sp/>__future__<sp/></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/>annotations</highlight></codeline>
<codeline lineno="3"><highlight class="normal"></highlight></codeline>
<codeline lineno="4"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/>asyncio</highlight></codeline>
<codeline lineno="5"><highlight class="normal"></highlight><highlight class="keyword">from</highlight><highlight class="normal"><sp/>datetime<sp/></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/>datetime</highlight></codeline>
<codeline lineno="6"><highlight class="normal"></highlight><highlight class="keyword">from</highlight><highlight class="normal"><sp/>enum<sp/></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/>Enum,<sp/>auto</highlight></codeline>
<codeline lineno="7"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/>json</highlight></codeline>
<codeline lineno="8"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/>logging</highlight></codeline>
<codeline lineno="9"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/>socket</highlight></codeline>
<codeline lineno="10"><highlight class="normal"></highlight><highlight class="keyword">from</highlight><highlight class="normal"><sp/>typing<sp/></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/>Any</highlight></codeline>
<codeline lineno="11"><highlight class="normal"></highlight></codeline>
<codeline lineno="12"><highlight class="normal"></highlight><highlight class="keyword">from</highlight><highlight class="normal"><sp/>klyqa_ctl.communication.local.data_package<sp/></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/>DataPackage,<sp/>PackageType</highlight></codeline>
<codeline lineno="13"><highlight class="normal"></highlight><highlight class="keyword">from</highlight><highlight class="normal"><sp/><ref refid="namespaceklyqa__ctl_1_1devices_1_1device" kindref="compound">klyqa_ctl.devices.device</ref><sp/></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/>Device</highlight></codeline>
<codeline lineno="14"><highlight class="normal"></highlight><highlight class="keyword">from</highlight><highlight class="normal"><sp/><ref refid="namespaceklyqa__ctl_1_1general_1_1general" kindref="compound">klyqa_ctl.general.general</ref><sp/></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/>(</highlight></codeline>
<codeline lineno="15"><highlight class="normal"><sp/><sp/><sp/><sp/>LOGGER,</highlight></codeline>
<codeline lineno="16"><highlight class="normal"><sp/><sp/><sp/><sp/>ReferencePass,</highlight></codeline>
<codeline lineno="17"><highlight class="normal"><sp/><sp/><sp/><sp/>task_log,</highlight></codeline>
<codeline lineno="18"><highlight class="normal"><sp/><sp/><sp/><sp/>task_log_debug,</highlight></codeline>
<codeline lineno="19"><highlight class="normal"><sp/><sp/><sp/><sp/>task_log_trace_ex,</highlight></codeline>
<codeline lineno="20"><highlight class="normal"><sp/><sp/><sp/><sp/>task_name,</highlight></codeline>
<codeline lineno="21"><highlight class="normal">)</highlight></codeline>
<codeline lineno="22"><highlight class="normal"></highlight></codeline>
<codeline lineno="23"><highlight class="normal"></highlight><highlight class="keywordflow">try</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="24"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">from</highlight><highlight class="normal"><sp/>Cryptodome.Random<sp/></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/>get_random_bytes<sp/><sp/></highlight><highlight class="comment">#<sp/>pycryptodome</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="25"><highlight class="normal"></highlight><highlight class="keywordflow">except</highlight><highlight class="normal"><sp/>ImportError:</highlight></codeline>
<codeline lineno="26"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">from</highlight><highlight class="normal"><sp/>Crypto.Random<sp/></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/>get_random_bytes<sp/><sp/></highlight><highlight class="comment">#<sp/>pycryptodome</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="27"><highlight class="normal"></highlight></codeline>
<codeline lineno="28"><highlight class="normal"></highlight></codeline>
<codeline lineno="29" refid="classlocal_1_1connection_1_1AesConnectionState" refkind="compound"><highlight class="normal"></highlight><highlight class="keyword">class<sp/></highlight><highlight class="normal"><ref refid="classlocal_1_1connection_1_1AesConnectionState" kindref="compound">AesConnectionState</ref>(<ref refid="classstr" kindref="compound">str</ref>,<sp/>Enum):</highlight></codeline>
<codeline lineno="30"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;&quot;&quot;AES<sp/>encrypted<sp/>connection<sp/>state.&quot;&quot;&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="31"><highlight class="normal"></highlight></codeline>
<codeline lineno="32" refid="classlocal_1_1connection_1_1AesConnectionState_1a3c62cbad8d666329210c08da2c1868e3" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/>WAIT_IV<sp/>=<sp/></highlight><highlight class="stringliteral">&quot;WAIT_IV&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="33" refid="classlocal_1_1connection_1_1AesConnectionState_1a773065e00e66d88cfceb4e019c43d4cd" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/>CONNECTED<sp/>=<sp/></highlight><highlight class="stringliteral">&quot;CONNECTED&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="34"><highlight class="normal"></highlight></codeline>
<codeline lineno="35"><highlight class="normal"></highlight></codeline>
<codeline lineno="36" refid="classlocal_1_1connection_1_1DeviceTcpReturn" refkind="compound"><highlight class="normal"></highlight><highlight class="keyword">class<sp/></highlight><highlight class="normal"><ref refid="classlocal_1_1connection_1_1DeviceTcpReturn" kindref="compound">DeviceTcpReturn</ref>(Enum):</highlight></codeline>
<codeline lineno="37" refid="classlocal_1_1connection_1_1DeviceTcpReturn_1a575e64d84cf1dc3b3e7f380678d02857" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/>NO_ERROR<sp/>=<sp/>auto()</highlight></codeline>
<codeline lineno="38" refid="classlocal_1_1connection_1_1DeviceTcpReturn_1a96068ad3cec63424f52ac09807a6e792" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/>SENT<sp/>=<sp/>auto()</highlight></codeline>
<codeline lineno="39" refid="classlocal_1_1connection_1_1DeviceTcpReturn_1a49c99cd610f60aa53cf5a447a7411743" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/>ANSWERED<sp/>=<sp/>auto()</highlight></codeline>
<codeline lineno="40" refid="classlocal_1_1connection_1_1DeviceTcpReturn_1aa46179a3e84509cc6d0f2a3472a035c6" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/>WRONG_UNIT_ID<sp/>=<sp/>auto()</highlight></codeline>
<codeline lineno="41" refid="classlocal_1_1connection_1_1DeviceTcpReturn_1a08e01c94ec2718b3b4d339b530d41c88" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/>NO_UNIT_ID<sp/>=<sp/>auto()</highlight></codeline>
<codeline lineno="42" refid="classlocal_1_1connection_1_1DeviceTcpReturn_1a26a728a36cff51e549829cbb29fc26f0" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/>WRONG_AES<sp/>=<sp/>auto()</highlight></codeline>
<codeline lineno="43" refid="classlocal_1_1connection_1_1DeviceTcpReturn_1a584a7d1ae43553afe3ac729efc038ea9" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/>TCP_ERROR<sp/>=<sp/>auto()</highlight></codeline>
<codeline lineno="44" refid="classlocal_1_1connection_1_1DeviceTcpReturn_1a63f99836d9003f350a43870e215f3d6c" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/>TCP_SOCKET_CLOSED_UNEXPECTEDLY<sp/>=<sp/>auto()</highlight></codeline>
<codeline lineno="45" refid="classlocal_1_1connection_1_1DeviceTcpReturn_1a219cbb351173c4ea383f5988f4979497" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/>UNKNOWN_ERROR<sp/>=<sp/>auto()</highlight></codeline>
<codeline lineno="46" refid="classlocal_1_1connection_1_1DeviceTcpReturn_1a7f2ffb1f23039fa5f14c721124ab5cd0" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/>SOCKET_TIMEOUT<sp/>=<sp/>auto()</highlight></codeline>
<codeline lineno="47" refid="classlocal_1_1connection_1_1DeviceTcpReturn_1a39abd2a11674c3143d2a48663678c68a" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/>NOTHING_DONE<sp/>=<sp/>auto()</highlight></codeline>
<codeline lineno="48" refid="classlocal_1_1connection_1_1DeviceTcpReturn_1aaef53e0a08ac5001147b428bf42da239" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/>SENT_ERROR<sp/>=<sp/>auto()</highlight></codeline>
<codeline lineno="49" refid="classlocal_1_1connection_1_1DeviceTcpReturn_1a24defce5bc78800909c822c42e384172" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/>NO_MESSAGE_TO_SEND<sp/>=<sp/>auto()</highlight></codeline>
<codeline lineno="50" refid="classlocal_1_1connection_1_1DeviceTcpReturn_1a1e0dbac25701e5ae4ae6a06c99d9f83b" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/>DEVICE_LOCK_TIMEOUT<sp/>=<sp/>auto()</highlight></codeline>
<codeline lineno="51" refid="classlocal_1_1connection_1_1DeviceTcpReturn_1a04cc50a64ee6d83dfda0dbb580308681" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/>ERROR_LOCAL_IV<sp/>=<sp/>auto()</highlight></codeline>
<codeline lineno="52" refid="classlocal_1_1connection_1_1DeviceTcpReturn_1a994a552f1eddb872bca4deb6531829f2" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/>MISSING_AES_KEY<sp/>=<sp/>auto()</highlight></codeline>
<codeline lineno="53" refid="classlocal_1_1connection_1_1DeviceTcpReturn_1a026072daea96ad996761bb59d288cf01" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/>RESPONSE_ERROR<sp/>=<sp/>auto()</highlight></codeline>
<codeline lineno="54" refid="classlocal_1_1connection_1_1DeviceTcpReturn_1ae4e6366139ede15a76f35cd331af1b9b" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/>SEND_ERROR<sp/>=<sp/>auto()</highlight></codeline>
<codeline lineno="55" refid="classlocal_1_1connection_1_1DeviceTcpReturn_1a6bf2e0fd3c017452190e81f7644ab4c4" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/>SOCKET_ERROR<sp/>=<sp/>auto()</highlight></codeline>
<codeline lineno="56"><highlight class="normal"></highlight></codeline>
<codeline lineno="57"><highlight class="normal"></highlight></codeline>
<codeline lineno="58" refid="classlocal_1_1connection_1_1TcpConnection" refkind="compound"><highlight class="normal"></highlight><highlight class="keyword">class<sp/></highlight><highlight class="normal"><ref refid="classlocal_1_1connection_1_1TcpConnection" kindref="compound">TcpConnection</ref>:</highlight></codeline>
<codeline lineno="59"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;&quot;&quot;Local<sp/>connection<sp/>class.&quot;&quot;&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="60"><highlight class="normal"></highlight></codeline>
<codeline lineno="61" refid="classlocal_1_1connection_1_1TcpConnection_1aae3f96e7c55fc45f5aa0c837c51a0069" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">def<sp/></highlight><highlight class="normal"><ref refid="classlocal_1_1connection_1_1TcpConnection_1aae3f96e7c55fc45f5aa0c837c51a0069" kindref="member">__init__</ref>(self)<sp/>-&gt;<sp/>None:</highlight></codeline>
<codeline lineno="62"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self.<ref refid="classlocal_1_1connection_1_1TcpConnection_1ad5ab95bf09b02f50760f9a5ef5ed2742" kindref="member">_attr_state</ref>_attr_state:<sp/>str<sp/>=<sp/>AesConnectionState.WAIT_IV</highlight></codeline>
<codeline lineno="63"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self.<ref refid="classlocal_1_1connection_1_1TcpConnection_1a61a5cdca3383b786f2dfacdc9fab545d" kindref="member">_attr_local_iv</ref>_attr_local_iv:<sp/>bytes<sp/>=<sp/>get_random_bytes(8)</highlight></codeline>
<codeline lineno="64"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self.<ref refid="classlocal_1_1connection_1_1TcpConnection_1a4df7e4486d250e634f1624c79f4557f5" kindref="member">_attr_remote_iv</ref>_attr_remote_iv:<sp/>bytes<sp/>=<sp/>b</highlight><highlight class="stringliteral">&quot;&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="65"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self.<ref refid="classlocal_1_1connection_1_1TcpConnection_1a013dafc1a2cb20ec4b01e8e9c946ca07" kindref="member">_attr_sending_aes</ref>_attr_sending_aes:<sp/>Any<sp/>=<sp/></highlight><highlight class="keywordtype">None</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="66"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self.<ref refid="classlocal_1_1connection_1_1TcpConnection_1abed797cb2fbba7f05663f50fd3588274" kindref="member">_attr_receiving_aes</ref>_attr_receiving_aes:<sp/>Any<sp/>=<sp/></highlight><highlight class="keywordtype">None</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="67"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self.<ref refid="classlocal_1_1connection_1_1TcpConnection_1a5f5e5b7c21e5d541773870a7c874c31d" kindref="member">_attr_address</ref>_attr_address:<sp/>dict[str,<sp/>str<sp/>|<sp/>int]<sp/>=<sp/>{</highlight><highlight class="stringliteral">&quot;ip&quot;</highlight><highlight class="normal">:<sp/></highlight><highlight class="stringliteral">&quot;&quot;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&quot;port&quot;</highlight><highlight class="normal">:<sp/>-1}</highlight></codeline>
<codeline lineno="68"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self.<ref refid="classlocal_1_1connection_1_1TcpConnection_1af475e2179e2c7eb74760af9de18658d3" kindref="member">_attr_socket</ref>_attr_socket:<sp/>socket.socket<sp/>|<sp/></highlight><highlight class="keywordtype">None</highlight><highlight class="normal"><sp/>=<sp/></highlight><highlight class="keywordtype">None</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="69"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self.<ref refid="classlocal_1_1connection_1_1TcpConnection_1aecef655d2a229eeb9bb89c07c60e3fbb" kindref="member">_attr_received_packages</ref>_attr_received_packages:<sp/>list[Any]<sp/>=<sp/>[]</highlight></codeline>
<codeline lineno="70"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self.<ref refid="classlocal_1_1connection_1_1TcpConnection_1ac9a08b297581f72eb90a021ef3514b6d" kindref="member">_attr_sent_msg_answer</ref>_attr_sent_msg_answer:<sp/>dict[str,<sp/>Any]<sp/>=<sp/>{}</highlight></codeline>
<codeline lineno="71"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self.<ref refid="classlocal_1_1connection_1_1TcpConnection_1aa8798c049ca270a895c4e2b577a12ee3" kindref="member">_attr_aes_key_confirmed</ref>_attr_aes_key_confirmed:<sp/>bool<sp/>=<sp/></highlight><highlight class="keyword">False</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="72"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self.<ref refid="classlocal_1_1connection_1_1TcpConnection_1a067873c0c97388f30c26eb172dc1c2c3" kindref="member">_attr_aes_key</ref>_attr_aes_key:<sp/>bytes<sp/>=<sp/>b</highlight><highlight class="stringliteral">&quot;&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="73"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self.<ref refid="classlocal_1_1connection_1_1TcpConnection_1a1efc8a42a9b00f35df0fdce03f3b415d" kindref="member">_attr_started</ref>_attr_started:<sp/>datetime<sp/>=<sp/>datetime.now()</highlight></codeline>
<codeline lineno="74"><highlight class="normal"></highlight></codeline>
<codeline lineno="75"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="preprocessor">@property</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="76" refid="classlocal_1_1connection_1_1TcpConnection_1aa95e22fd936309fb5e27c1cf2f8d264c" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">def<sp/></highlight><highlight class="normal"><ref refid="classlocal_1_1connection_1_1TcpConnection_1aa95e22fd936309fb5e27c1cf2f8d264c" kindref="member">state</ref>(self)<sp/>-&gt;<sp/>str:</highlight></codeline>
<codeline lineno="77"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>self.<ref refid="classlocal_1_1connection_1_1TcpConnection_1ad5ab95bf09b02f50760f9a5ef5ed2742" kindref="member">_attr_state</ref>_attr_state</highlight></codeline>
<codeline lineno="78"><highlight class="normal"></highlight></codeline>
<codeline lineno="79"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="preprocessor">@state.setter</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="80" refid="classlocal_1_1connection_1_1TcpConnection_1a19f316b71fea5b145f251820f7796242" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">def<sp/></highlight><highlight class="normal"><ref refid="classlocal_1_1connection_1_1TcpConnection_1aa95e22fd936309fb5e27c1cf2f8d264c" kindref="member">state</ref>(self,<sp/>state:<sp/>str)<sp/>-&gt;<sp/></highlight><highlight class="keywordtype">None</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="81" refid="classlocal_1_1connection_1_1TcpConnection_1ad5ab95bf09b02f50760f9a5ef5ed2742" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self.<ref refid="classlocal_1_1connection_1_1TcpConnection_1ad5ab95bf09b02f50760f9a5ef5ed2742" kindref="member">_attr_state</ref>_attr_state<sp/>=<sp/>state</highlight></codeline>
<codeline lineno="82"><highlight class="normal"></highlight></codeline>
<codeline lineno="83"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="preprocessor">@property</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="84" refid="classlocal_1_1connection_1_1TcpConnection_1ae8ee1c2b1b2568367c3a9cf16c1c976c" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">def<sp/></highlight><highlight class="normal"><ref refid="classlocal_1_1connection_1_1TcpConnection_1ae8ee1c2b1b2568367c3a9cf16c1c976c" kindref="member">remote_iv</ref>(self)<sp/>-&gt;<sp/>bytes:</highlight></codeline>
<codeline lineno="85"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>self.<ref refid="classlocal_1_1connection_1_1TcpConnection_1a4df7e4486d250e634f1624c79f4557f5" kindref="member">_attr_remote_iv</ref>_attr_remote_iv</highlight></codeline>
<codeline lineno="86"><highlight class="normal"></highlight></codeline>
<codeline lineno="87"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="preprocessor">@remote_iv.setter</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="88" refid="classlocal_1_1connection_1_1TcpConnection_1a610ebced44ea240a18fcc38962d97e44" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">def<sp/></highlight><highlight class="normal"><ref refid="classlocal_1_1connection_1_1TcpConnection_1ae8ee1c2b1b2568367c3a9cf16c1c976c" kindref="member">remote_iv</ref>(self,<sp/>remote_iv:<sp/>bytes)<sp/>-&gt;<sp/></highlight><highlight class="keywordtype">None</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="89" refid="classlocal_1_1connection_1_1TcpConnection_1a4df7e4486d250e634f1624c79f4557f5" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self.<ref refid="classlocal_1_1connection_1_1TcpConnection_1a4df7e4486d250e634f1624c79f4557f5" kindref="member">_attr_remote_iv</ref>_attr_remote_iv<sp/>=<sp/>remote_iv</highlight></codeline>
<codeline lineno="90"><highlight class="normal"></highlight></codeline>
<codeline lineno="91"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="preprocessor">@property</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="92" refid="classlocal_1_1connection_1_1TcpConnection_1aaa2925f711f018a95339c1457e9c7c0a" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">def<sp/></highlight><highlight class="normal"><ref refid="classlocal_1_1connection_1_1TcpConnection_1aaa2925f711f018a95339c1457e9c7c0a" kindref="member">local_iv</ref>(self)<sp/>-&gt;<sp/>bytes:</highlight></codeline>
<codeline lineno="93"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>self.<ref refid="classlocal_1_1connection_1_1TcpConnection_1a61a5cdca3383b786f2dfacdc9fab545d" kindref="member">_attr_local_iv</ref>_attr_local_iv</highlight></codeline>
<codeline lineno="94"><highlight class="normal"></highlight></codeline>
<codeline lineno="95"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="preprocessor">@local_iv.setter</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="96" refid="classlocal_1_1connection_1_1TcpConnection_1a34fd7c856221dc4f4f5e666877eef26c" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">def<sp/></highlight><highlight class="normal"><ref refid="classlocal_1_1connection_1_1TcpConnection_1aaa2925f711f018a95339c1457e9c7c0a" kindref="member">local_iv</ref>(self,<sp/>local_iv:<sp/>bytes)<sp/>-&gt;<sp/></highlight><highlight class="keywordtype">None</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="97" refid="classlocal_1_1connection_1_1TcpConnection_1a61a5cdca3383b786f2dfacdc9fab545d" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self.<ref refid="classlocal_1_1connection_1_1TcpConnection_1a61a5cdca3383b786f2dfacdc9fab545d" kindref="member">_attr_local_iv</ref>_attr_local_iv<sp/>=<sp/>local_iv</highlight></codeline>
<codeline lineno="98"><highlight class="normal"></highlight></codeline>
<codeline lineno="99"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="preprocessor">@property</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="100" refid="classlocal_1_1connection_1_1TcpConnection_1a4f160b2ac07e3eb3d4ed420723d272ed" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">def<sp/></highlight><highlight class="normal"><ref refid="classlocal_1_1connection_1_1TcpConnection_1a4f160b2ac07e3eb3d4ed420723d272ed" kindref="member">sending_aes</ref>(self)<sp/>-&gt;<sp/>Any:</highlight></codeline>
<codeline lineno="101"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>self.<ref refid="classlocal_1_1connection_1_1TcpConnection_1a013dafc1a2cb20ec4b01e8e9c946ca07" kindref="member">_attr_sending_aes</ref>_attr_sending_aes</highlight></codeline>
<codeline lineno="102"><highlight class="normal"></highlight></codeline>
<codeline lineno="103"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="preprocessor">@sending_aes.setter</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="104" refid="classlocal_1_1connection_1_1TcpConnection_1ad3cd8182c4e0eb009a296d47a2ae969e" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">def<sp/></highlight><highlight class="normal"><ref refid="classlocal_1_1connection_1_1TcpConnection_1a4f160b2ac07e3eb3d4ed420723d272ed" kindref="member">sending_aes</ref>(self,<sp/>sending_aes:<sp/>Any)<sp/>-&gt;<sp/></highlight><highlight class="keywordtype">None</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="105" refid="classlocal_1_1connection_1_1TcpConnection_1a013dafc1a2cb20ec4b01e8e9c946ca07" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self.<ref refid="classlocal_1_1connection_1_1TcpConnection_1a013dafc1a2cb20ec4b01e8e9c946ca07" kindref="member">_attr_sending_aes</ref>_attr_sending_aes<sp/>=<sp/>sending_aes</highlight></codeline>
<codeline lineno="106"><highlight class="normal"></highlight></codeline>
<codeline lineno="107"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="preprocessor">@property</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="108" refid="classlocal_1_1connection_1_1TcpConnection_1a8155e332b2255c6b7a0719f0a14ba835" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">def<sp/></highlight><highlight class="normal"><ref refid="classlocal_1_1connection_1_1TcpConnection_1a8155e332b2255c6b7a0719f0a14ba835" kindref="member">receiving_aes</ref>(self)<sp/>-&gt;<sp/>Any:</highlight></codeline>
<codeline lineno="109"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>self.<ref refid="classlocal_1_1connection_1_1TcpConnection_1abed797cb2fbba7f05663f50fd3588274" kindref="member">_attr_receiving_aes</ref>_attr_receiving_aes</highlight></codeline>
<codeline lineno="110"><highlight class="normal"></highlight></codeline>
<codeline lineno="111"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="preprocessor">@receiving_aes.setter</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="112" refid="classlocal_1_1connection_1_1TcpConnection_1ae4cf20c59d31c28554d82af9e1c0ccb6" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">def<sp/></highlight><highlight class="normal"><ref refid="classlocal_1_1connection_1_1TcpConnection_1a8155e332b2255c6b7a0719f0a14ba835" kindref="member">receiving_aes</ref>(self,<sp/>receiving_aes:<sp/>Any)<sp/>-&gt;<sp/></highlight><highlight class="keywordtype">None</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="113" refid="classlocal_1_1connection_1_1TcpConnection_1abed797cb2fbba7f05663f50fd3588274" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self.<ref refid="classlocal_1_1connection_1_1TcpConnection_1abed797cb2fbba7f05663f50fd3588274" kindref="member">_attr_receiving_aes</ref>_attr_receiving_aes<sp/>=<sp/>receiving_aes</highlight></codeline>
<codeline lineno="114"><highlight class="normal"></highlight></codeline>
<codeline lineno="115"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="preprocessor">@property</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="116" refid="classlocal_1_1connection_1_1TcpConnection_1aaf41f85908a1e964676863fe1005b650" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">def<sp/></highlight><highlight class="normal"><ref refid="classlocal_1_1connection_1_1TcpConnection_1aaf41f85908a1e964676863fe1005b650" kindref="member">address</ref>(self)<sp/>-&gt;<sp/>dict[str,<sp/>str<sp/>|<sp/>int]:</highlight></codeline>
<codeline lineno="117"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>self.<ref refid="classlocal_1_1connection_1_1TcpConnection_1a5f5e5b7c21e5d541773870a7c874c31d" kindref="member">_attr_address</ref>_attr_address</highlight></codeline>
<codeline lineno="118"><highlight class="normal"></highlight></codeline>
<codeline lineno="119"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="preprocessor">@address.setter</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="120" refid="classlocal_1_1connection_1_1TcpConnection_1a8bdd6f3e1c30a2e6671f52b76282fb27" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">def<sp/></highlight><highlight class="normal"><ref refid="classlocal_1_1connection_1_1TcpConnection_1aaf41f85908a1e964676863fe1005b650" kindref="member">address</ref>(self,<sp/>address:<sp/>dict[str,<sp/>str<sp/>|<sp/>int])<sp/>-&gt;<sp/></highlight><highlight class="keywordtype">None</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="121" refid="classlocal_1_1connection_1_1TcpConnection_1a5f5e5b7c21e5d541773870a7c874c31d" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self.<ref refid="classlocal_1_1connection_1_1TcpConnection_1a5f5e5b7c21e5d541773870a7c874c31d" kindref="member">_attr_address</ref>_attr_address<sp/>=<sp/>address</highlight></codeline>
<codeline lineno="122"><highlight class="normal"></highlight></codeline>
<codeline lineno="123"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="preprocessor">@property</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="124" refid="classlocal_1_1connection_1_1TcpConnection_1abbbb7415b2c8a01af2e84d618895f855" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">def<sp/></highlight><highlight class="normal"><ref refid="classlocal_1_1connection_1_1TcpConnection_1abbbb7415b2c8a01af2e84d618895f855" kindref="member">socket</ref>(self)<sp/>-&gt;<sp/>socket.socket<sp/>|<sp/>None:</highlight></codeline>
<codeline lineno="125"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>self.<ref refid="classlocal_1_1connection_1_1TcpConnection_1af475e2179e2c7eb74760af9de18658d3" kindref="member">_attr_socket</ref>_attr_socket</highlight></codeline>
<codeline lineno="126"><highlight class="normal"></highlight></codeline>
<codeline lineno="127"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="preprocessor">@socket.setter</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="128" refid="classlocal_1_1connection_1_1TcpConnection_1a4611e0483aef05cdd079a70651fa6aef" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">def<sp/></highlight><highlight class="normal"><ref refid="classlocal_1_1connection_1_1TcpConnection_1abbbb7415b2c8a01af2e84d618895f855" kindref="member">socket</ref>(self,<sp/>socket:<sp/>socket.socket<sp/>|<sp/></highlight><highlight class="keywordtype">None</highlight><highlight class="normal">)<sp/>-&gt;<sp/></highlight><highlight class="keywordtype">None</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="129" refid="classlocal_1_1connection_1_1TcpConnection_1af475e2179e2c7eb74760af9de18658d3" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self.<ref refid="classlocal_1_1connection_1_1TcpConnection_1af475e2179e2c7eb74760af9de18658d3" kindref="member">_attr_socket</ref>_attr_socket<sp/>=<sp/>socket</highlight></codeline>
<codeline lineno="130"><highlight class="normal"></highlight></codeline>
<codeline lineno="131"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="preprocessor">@property</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="132" refid="classlocal_1_1connection_1_1TcpConnection_1aff47b879423ffb2355ab33e3dee97128" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">def<sp/></highlight><highlight class="normal"><ref refid="classlocal_1_1connection_1_1TcpConnection_1aff47b879423ffb2355ab33e3dee97128" kindref="member">received_packages</ref>(self)<sp/>-&gt;<sp/>list[Any]:</highlight></codeline>
<codeline lineno="133"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>self.<ref refid="classlocal_1_1connection_1_1TcpConnection_1aecef655d2a229eeb9bb89c07c60e3fbb" kindref="member">_attr_received_packages</ref>_attr_received_packages</highlight></codeline>
<codeline lineno="134"><highlight class="normal"></highlight></codeline>
<codeline lineno="135"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="preprocessor">@received_packages.setter</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="136" refid="classlocal_1_1connection_1_1TcpConnection_1a4a1b304e58855e9092b938eb27db0a37" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">def<sp/></highlight><highlight class="normal"><ref refid="classlocal_1_1connection_1_1TcpConnection_1aff47b879423ffb2355ab33e3dee97128" kindref="member">received_packages</ref>(self,<sp/>received_packages:<sp/>list[Any])<sp/>-&gt;<sp/></highlight><highlight class="keywordtype">None</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="137" refid="classlocal_1_1connection_1_1TcpConnection_1aecef655d2a229eeb9bb89c07c60e3fbb" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self.<ref refid="classlocal_1_1connection_1_1TcpConnection_1aecef655d2a229eeb9bb89c07c60e3fbb" kindref="member">_attr_received_packages</ref>_attr_received_packages<sp/>=<sp/>received_packages</highlight></codeline>
<codeline lineno="138"><highlight class="normal"></highlight></codeline>
<codeline lineno="139"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="preprocessor">@property</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="140" refid="classlocal_1_1connection_1_1TcpConnection_1aba6ac9e7294c88d32d28ede280c46d02" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">def<sp/></highlight><highlight class="normal"><ref refid="classlocal_1_1connection_1_1TcpConnection_1aba6ac9e7294c88d32d28ede280c46d02" kindref="member">sent_msg_answer</ref>(self)<sp/>-&gt;<sp/>dict[str,<sp/>Any]:</highlight></codeline>
<codeline lineno="141"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>self.<ref refid="classlocal_1_1connection_1_1TcpConnection_1ac9a08b297581f72eb90a021ef3514b6d" kindref="member">_attr_sent_msg_answer</ref>_attr_sent_msg_answer</highlight></codeline>
<codeline lineno="142"><highlight class="normal"></highlight></codeline>
<codeline lineno="143"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="preprocessor">@sent_msg_answer.setter</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="144" refid="classlocal_1_1connection_1_1TcpConnection_1a42c436ed6a7982b846d1f55d6033a2da" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">def<sp/></highlight><highlight class="normal"><ref refid="classlocal_1_1connection_1_1TcpConnection_1aba6ac9e7294c88d32d28ede280c46d02" kindref="member">sent_msg_answer</ref>(self,<sp/>sent_msg_answer:<sp/>dict[str,<sp/>Any])<sp/>-&gt;<sp/></highlight><highlight class="keywordtype">None</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="145" refid="classlocal_1_1connection_1_1TcpConnection_1ac9a08b297581f72eb90a021ef3514b6d" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self.<ref refid="classlocal_1_1connection_1_1TcpConnection_1ac9a08b297581f72eb90a021ef3514b6d" kindref="member">_attr_sent_msg_answer</ref>_attr_sent_msg_answer<sp/>=<sp/>sent_msg_answer</highlight></codeline>
<codeline lineno="146"><highlight class="normal"></highlight></codeline>
<codeline lineno="147"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="preprocessor">@property</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="148" refid="classlocal_1_1connection_1_1TcpConnection_1a352102b28c6aa3f1833cd0aaf0ea842a" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">def<sp/></highlight><highlight class="normal"><ref refid="classlocal_1_1connection_1_1TcpConnection_1a352102b28c6aa3f1833cd0aaf0ea842a" kindref="member">aes_key_confirmed</ref>(self)<sp/>-&gt;<sp/>bool:</highlight></codeline>
<codeline lineno="149"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>self.<ref refid="classlocal_1_1connection_1_1TcpConnection_1aa8798c049ca270a895c4e2b577a12ee3" kindref="member">_attr_aes_key_confirmed</ref>_attr_aes_key_confirmed</highlight></codeline>
<codeline lineno="150"><highlight class="normal"></highlight></codeline>
<codeline lineno="151"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="preprocessor">@aes_key_confirmed.setter</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="152" refid="classlocal_1_1connection_1_1TcpConnection_1a050e0d8bf82d293467b238174abbe722" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">def<sp/></highlight><highlight class="normal"><ref refid="classlocal_1_1connection_1_1TcpConnection_1a352102b28c6aa3f1833cd0aaf0ea842a" kindref="member">aes_key_confirmed</ref>(self,<sp/>aes_key_confirmed:<sp/>bool)<sp/>-&gt;<sp/></highlight><highlight class="keywordtype">None</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="153" refid="classlocal_1_1connection_1_1TcpConnection_1aa8798c049ca270a895c4e2b577a12ee3" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self.<ref refid="classlocal_1_1connection_1_1TcpConnection_1aa8798c049ca270a895c4e2b577a12ee3" kindref="member">_attr_aes_key_confirmed</ref>_attr_aes_key_confirmed<sp/>=<sp/>aes_key_confirmed</highlight></codeline>
<codeline lineno="154"><highlight class="normal"></highlight></codeline>
<codeline lineno="155"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="preprocessor">@property</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="156" refid="classlocal_1_1connection_1_1TcpConnection_1a1996ebbb501299a829bb433cebc0d303" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">def<sp/></highlight><highlight class="normal"><ref refid="classlocal_1_1connection_1_1TcpConnection_1a1996ebbb501299a829bb433cebc0d303" kindref="member">aes_key</ref>(self)<sp/>-&gt;<sp/>bytes:</highlight></codeline>
<codeline lineno="157"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>self.<ref refid="classlocal_1_1connection_1_1TcpConnection_1a067873c0c97388f30c26eb172dc1c2c3" kindref="member">_attr_aes_key</ref>_attr_aes_key</highlight></codeline>
<codeline lineno="158"><highlight class="normal"></highlight></codeline>
<codeline lineno="159"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="preprocessor">@aes_key.setter</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="160" refid="classlocal_1_1connection_1_1TcpConnection_1abe7332fbdf0675a52b2c9f546c84fd44" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">def<sp/></highlight><highlight class="normal"><ref refid="classlocal_1_1connection_1_1TcpConnection_1a1996ebbb501299a829bb433cebc0d303" kindref="member">aes_key</ref>(self,<sp/>aes_key:<sp/>bytes)<sp/>-&gt;<sp/></highlight><highlight class="keywordtype">None</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="161" refid="classlocal_1_1connection_1_1TcpConnection_1a067873c0c97388f30c26eb172dc1c2c3" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self.<ref refid="classlocal_1_1connection_1_1TcpConnection_1a067873c0c97388f30c26eb172dc1c2c3" kindref="member">_attr_aes_key</ref>_attr_aes_key<sp/>=<sp/>aes_key</highlight></codeline>
<codeline lineno="162"><highlight class="normal"></highlight></codeline>
<codeline lineno="163"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="preprocessor">@property</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="164" refid="classlocal_1_1connection_1_1TcpConnection_1a47f1fe8d61f1bb165008723a321e376b" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">def<sp/></highlight><highlight class="normal"><ref refid="classlocal_1_1connection_1_1TcpConnection_1a47f1fe8d61f1bb165008723a321e376b" kindref="member">started</ref>(self)<sp/>-&gt;<sp/>datetime:</highlight></codeline>
<codeline lineno="165"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>self.<ref refid="classlocal_1_1connection_1_1TcpConnection_1a1efc8a42a9b00f35df0fdce03f3b415d" kindref="member">_attr_started</ref>_attr_started</highlight></codeline>
<codeline lineno="166"><highlight class="normal"></highlight></codeline>
<codeline lineno="167"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="preprocessor">@started.setter</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="168" refid="classlocal_1_1connection_1_1TcpConnection_1a2c76c5da17903abd1dac9e28906e42f9" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">def<sp/></highlight><highlight class="normal"><ref refid="classlocal_1_1connection_1_1TcpConnection_1a47f1fe8d61f1bb165008723a321e376b" kindref="member">started</ref>(self,<sp/>started:<sp/>datetime)<sp/>-&gt;<sp/></highlight><highlight class="keywordtype">None</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="169" refid="classlocal_1_1connection_1_1TcpConnection_1a1efc8a42a9b00f35df0fdce03f3b415d" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self.<ref refid="classlocal_1_1connection_1_1TcpConnection_1a1efc8a42a9b00f35df0fdce03f3b415d" kindref="member">_attr_started</ref>_attr_started<sp/>=<sp/>started</highlight></codeline>
<codeline lineno="170"><highlight class="normal"></highlight></codeline>
<codeline lineno="171" refid="classlocal_1_1connection_1_1TcpConnection_1a65ab7164f0d09f1380e3837905a602b7" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/>async<sp/></highlight><highlight class="keyword">def<sp/></highlight><highlight class="normal"><ref refid="classlocal_1_1connection_1_1TcpConnection_1a65ab7164f0d09f1380e3837905a602b7" kindref="member">read_local_tcp_socket</ref>(</highlight></codeline>
<codeline lineno="172"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self,<sp/>data_ref:<sp/>ReferencePass</highlight></codeline>
<codeline lineno="173"><highlight class="normal"><sp/><sp/><sp/><sp/>)<sp/>-&gt;<sp/>DeviceTcpReturn:</highlight></codeline>
<codeline lineno="174"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;&quot;&quot;Read<sp/>from<sp/>tcp<sp/>socket<sp/>and<sp/>handle<sp/>some<sp/>exceptions.&quot;&quot;&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="175"><highlight class="normal"></highlight></codeline>
<codeline lineno="176"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>loop:<sp/>asyncio.AbstractEventLoop<sp/>=<sp/>asyncio.get_event_loop()</highlight></codeline>
<codeline lineno="177"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>self.<ref refid="classlocal_1_1connection_1_1TcpConnection_1abbbb7415b2c8a01af2e84d618895f855" kindref="member">socket</ref><ref refid="classlocal_1_1connection_1_1TcpConnection_1a4611e0483aef05cdd079a70651fa6aef" kindref="member">socket</ref>socket<sp/></highlight><highlight class="keywordflow">is</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">None</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="178"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>DeviceTcpReturn.SOCKET_ERROR</highlight></codeline>
<codeline lineno="179"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">try</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="180"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="namespaceklyqa__ctl_1_1general_1_1general_1a1afe30a73cc28a3b65babeeab27e36c8" kindref="member">task_log_debug</ref>(</highlight><highlight class="stringliteral">&quot;Read<sp/>tcp<sp/>socket<sp/>to<sp/>device.&quot;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="181"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>data_ref.ref<sp/>=<sp/>await<sp/>loop.sock_recv(self.<ref refid="classlocal_1_1connection_1_1TcpConnection_1abbbb7415b2c8a01af2e84d618895f855" kindref="member">socket</ref><ref refid="classlocal_1_1connection_1_1TcpConnection_1a4611e0483aef05cdd079a70651fa6aef" kindref="member">socket</ref>socket,<sp/>4096)</highlight></codeline>
<codeline lineno="182"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>len(data_ref.ref)<sp/>==<sp/>0:</highlight></codeline>
<codeline lineno="183"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="namespaceklyqa__ctl_1_1general_1_1general_1a9df3b50dfc0fcc7c8ec991bb9be9c5ba" kindref="member">task_log</ref>(</highlight><highlight class="stringliteral">&quot;TCP<sp/>connection<sp/>ended<sp/>unexpectedly!&quot;</highlight><highlight class="normal">,<sp/>LOGGER.error)</highlight></codeline>
<codeline lineno="184"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>DeviceTcpReturn.TCP_SOCKET_CLOSED_UNEXPECTEDLY</highlight></codeline>
<codeline lineno="185"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">except</highlight><highlight class="normal"><sp/>socket.timeout:</highlight></codeline>
<codeline lineno="186"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="namespaceklyqa__ctl_1_1general_1_1general_1a9df3b50dfc0fcc7c8ec991bb9be9c5ba" kindref="member">task_log</ref>(</highlight><highlight class="stringliteral">&quot;socket.timeout.&quot;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="187"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">except</highlight><highlight class="normal"><sp/>socket.error:</highlight></codeline>
<codeline lineno="188"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="namespaceklyqa__ctl_1_1general_1_1general_1ad6b753e482e539892c57f8144cf213cb" kindref="member">task_log_trace_ex</ref>()</highlight></codeline>
<codeline lineno="189"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>DeviceTcpReturn.SOCKET_ERROR</highlight></codeline>
<codeline lineno="190"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>DeviceTcpReturn.NO_ERROR</highlight></codeline>
<codeline lineno="191"><highlight class="normal"></highlight></codeline>
<codeline lineno="192" refid="classlocal_1_1connection_1_1TcpConnection_1a305b3adb5bd8041bbaa53f47d1c23e81" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/>async<sp/></highlight><highlight class="keyword">def<sp/></highlight><highlight class="normal"><ref refid="classlocal_1_1connection_1_1TcpConnection_1a305b3adb5bd8041bbaa53f47d1c23e81" kindref="member">encrypt_and_send_msg</ref>(self,<sp/>msg:<sp/>str,<sp/>device:<sp/>Device)<sp/>-&gt;<sp/>bool:</highlight></codeline>
<codeline lineno="193"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;&quot;&quot;Encrypt<sp/>the<sp/>msg<sp/>with<sp/>aes<sp/>and<sp/>send<sp/>it<sp/>over<sp/>the<sp/>socket.&quot;&quot;&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="194"><highlight class="normal"></highlight></codeline>
<codeline lineno="195"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>loop:<sp/>asyncio.AbstractEventLoop<sp/>=<sp/>asyncio.get_event_loop()</highlight></codeline>
<codeline lineno="196"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>info_str:<sp/>str<sp/>=<sp/>(</highlight></codeline>
<codeline lineno="197"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>(f</highlight><highlight class="stringliteral">&quot;{task_name()}<sp/>-<sp/>&quot;</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>LOGGER.level<sp/>==<sp/>logging.DEBUG<sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/></highlight><highlight class="stringliteral">&quot;&quot;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="198"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>+<sp/></highlight><highlight class="stringliteral">&apos;Sending<sp/>in<sp/>local<sp/>network<sp/>to<sp/>&quot;&apos;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="199"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>+<sp/>device.get_name()</highlight></codeline>
<codeline lineno="200"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>+<sp/></highlight><highlight class="stringliteral">&apos;&quot;:<sp/>&apos;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="201"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>+<sp/>json.dumps(json.loads(msg),<sp/>sort_keys=</highlight><highlight class="keyword">True</highlight><highlight class="normal">,<sp/>indent=4)</highlight></codeline>
<codeline lineno="202"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>)</highlight></codeline>
<codeline lineno="203"><highlight class="normal"></highlight></codeline>
<codeline lineno="204"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>LOGGER.info(info_str)</highlight></codeline>
<codeline lineno="205"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>plain:<sp/>bytes<sp/>=<sp/>msg.encode(</highlight><highlight class="stringliteral">&quot;utf-8&quot;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="206"><highlight class="normal"></highlight></codeline>
<codeline lineno="207"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>package:<sp/>bytes<sp/>=<sp/>DataPackage.create(plain,<sp/>PackageType.ENC).serialize(</highlight></codeline>
<codeline lineno="208"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self.<ref refid="classlocal_1_1connection_1_1TcpConnection_1a4f160b2ac07e3eb3d4ed420723d272ed" kindref="member">sending_aes</ref><ref refid="classlocal_1_1connection_1_1TcpConnection_1ad3cd8182c4e0eb009a296d47a2ae969e" kindref="member">sending_aes</ref>sending_aes</highlight></codeline>
<codeline lineno="209"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>)</highlight></codeline>
<codeline lineno="210"><highlight class="normal"></highlight></codeline>
<codeline lineno="211"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">while</highlight><highlight class="normal"><sp/>self.<ref refid="classlocal_1_1connection_1_1TcpConnection_1abbbb7415b2c8a01af2e84d618895f855" kindref="member">socket</ref><ref refid="classlocal_1_1connection_1_1TcpConnection_1a4611e0483aef05cdd079a70651fa6aef" kindref="member">socket</ref>socket:</highlight></codeline>
<codeline lineno="212"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">try</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="213"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>await<sp/>loop.sock_sendall(self.<ref refid="classlocal_1_1connection_1_1TcpConnection_1abbbb7415b2c8a01af2e84d618895f855" kindref="member">socket</ref><ref refid="classlocal_1_1connection_1_1TcpConnection_1a4611e0483aef05cdd079a70651fa6aef" kindref="member">socket</ref>socket,<sp/>package)</highlight></codeline>
<codeline lineno="214"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">True</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="215"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">except</highlight><highlight class="normal"><sp/>socket.timeout:</highlight></codeline>
<codeline lineno="216"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="namespaceklyqa__ctl_1_1general_1_1general_1a1afe30a73cc28a3b65babeeab27e36c8" kindref="member">task_log_debug</ref>(</highlight><highlight class="stringliteral">&quot;Send<sp/>timed<sp/>out,<sp/>retrying...&quot;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="217"><highlight class="normal"></highlight></codeline>
<codeline lineno="218"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">False</highlight><highlight class="normal"></highlight></codeline>
    </programlisting>
    <location file="communication/local/connection.py"/>
  </compounddef>
</doxygen>
