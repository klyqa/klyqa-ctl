\hypertarget{namespaceklyqa__ctl_1_1klyqa__ctl}{}\doxysection{klyqa\+\_\+ctl.\+klyqa\+\_\+ctl Namespace Reference}
\label{namespaceklyqa__ctl_1_1klyqa__ctl}\index{klyqa\_ctl.klyqa\_ctl@{klyqa\_ctl.klyqa\_ctl}}
\doxysubsection*{Classes}
\begin{DoxyCompactItemize}
\item 
class \mbox{\hyperlink{classklyqa__ctl_1_1klyqa__ctl_1_1Client}{Client}}
\end{DoxyCompactItemize}
\doxysubsection*{Functions}
\begin{DoxyCompactItemize}
\item 
None \mbox{\hyperlink{namespaceklyqa__ctl_1_1klyqa__ctl_afe1b8490f9810b885e4048d7bef472a7}{main}} ()
\end{DoxyCompactItemize}
\doxysubsection*{Variables}
\begin{DoxyCompactItemize}
\item 
\mbox{\hyperlink{namespaceklyqa__ctl_1_1klyqa__ctl_ab6c1a4b950d3c6e69d273cbb9a602266}{Abstract\+Event\+Loop}}
\end{DoxyCompactItemize}


\doxysubsection{Detailed Description}
\begin{DoxyVerb}Klyqa control client.

Interactive Klyqa Control commandline client

Company: QConnex GmbH / Klyqa
Author: Frederick Stallmeyer

E-Mail: frederick.stallmeyer@gmx.de

Information:
The network_interface parameter for local connection handling (in
LocalConnectionHandler) will ONLY work on LINUX systems, as it uses the linux
specific socket option SO_BINDTODEVICE for communication.

Nice to haves/missing:
  -   list cloud connected devices in discovery.
  -   offer for selected devices possible commands and arguments in
      interactive mode based on their device profile
  -   Implementation for the different device config profile versions and
      check on send.
  -   start scene support in cloud mode

Current bugs:
 - vc1 interactive command selection support.
 - interactive light selection, command not applied\end{DoxyVerb}
 

\doxysubsection{Function Documentation}
\mbox{\Hypertarget{namespaceklyqa__ctl_1_1klyqa__ctl_afe1b8490f9810b885e4048d7bef472a7}\label{namespaceklyqa__ctl_1_1klyqa__ctl_afe1b8490f9810b885e4048d7bef472a7}} 
\index{klyqa\_ctl.klyqa\_ctl@{klyqa\_ctl.klyqa\_ctl}!main@{main}}
\index{main@{main}!klyqa\_ctl.klyqa\_ctl@{klyqa\_ctl.klyqa\_ctl}}
\doxysubsubsection{\texorpdfstring{main()}{main()}}
{\footnotesize\ttfamily  None klyqa\+\_\+ctl.\+klyqa\+\_\+ctl.\+main (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}

\begin{DoxyVerb}Main function.\end{DoxyVerb}
 
\begin{DoxyCode}{0}
\DoxyCodeLine{700 async \textcolor{keyword}{def }\mbox{\hyperlink{namespaceklyqa__ctl_1_1klyqa__ctl_afe1b8490f9810b885e4048d7bef472a7}{main}}() -\/> None:}
\DoxyCodeLine{701     \textcolor{stringliteral}{"{}"{}"{}Main function."{}"{}"{}}}
\DoxyCodeLine{702 }
\DoxyCodeLine{703     exit\_ret: int = 0}
\DoxyCodeLine{704 }
\DoxyCodeLine{705     parser: argparse.ArgumentParser = \mbox{\hyperlink{namespaceklyqa__ctl_1_1general_1_1parameters_a38b90c6125a60eeabd89d4addab053b4}{get\_description\_parser}}()}
\DoxyCodeLine{706 }
\DoxyCodeLine{707     \mbox{\hyperlink{namespaceklyqa__ctl_1_1general_1_1parameters_a4d4508f84ab7a6044c74575f197f852b}{add\_config\_args}}(parser=parser)}
\DoxyCodeLine{708 }
\DoxyCodeLine{709     args\_in: list[str] = sys.argv[1:]}
\DoxyCodeLine{710 }
\DoxyCodeLine{711     (}
\DoxyCodeLine{712         config\_args\_parsed,}
\DoxyCodeLine{713         \_,}
\DoxyCodeLine{714     ) = parser.parse\_known\_args(args=args\_in)}
\DoxyCodeLine{715 }
\DoxyCodeLine{716     \textcolor{keywordflow}{if} config\_args\_parsed.type == DeviceType.CLEANER.value:}
\DoxyCodeLine{717         \mbox{\hyperlink{namespaceklyqa__ctl_1_1devices_1_1vacuum_1_1commands_ad486c28adf7b9c4ed9672fc04dfde7ef}{add\_command\_args\_cleaner}}(parser=parser)}
\DoxyCodeLine{718     \textcolor{keywordflow}{elif} config\_args\_parsed.type == DeviceType.LIGHTING.value:}
\DoxyCodeLine{719         \mbox{\hyperlink{namespaceklyqa__ctl_1_1devices_1_1light_1_1commands_a9a2f224816a4dab65a2d877cd38b657b}{add\_command\_args\_bulb}}(parser=parser)}
\DoxyCodeLine{720     \textcolor{keywordflow}{else}:}
\DoxyCodeLine{721         LOGGER.error(\textcolor{stringliteral}{"{}Unknown command type."{}})}
\DoxyCodeLine{722         sys.exit(1)}
\DoxyCodeLine{723 }
\DoxyCodeLine{724     \textcolor{keywordflow}{if} len(args\_in) < 2 \textcolor{keywordflow}{or} config\_args\_parsed.help:}
\DoxyCodeLine{725         parser.print\_help()}
\DoxyCodeLine{726         sys.exit(1)}
\DoxyCodeLine{727 }
\DoxyCodeLine{728     args\_parsed: argparse.Namespace = parser.parse\_args(args=args\_in)}
\DoxyCodeLine{729 }
\DoxyCodeLine{730     \textcolor{keywordflow}{if} args\_parsed.version:}
\DoxyCodeLine{731         print(\_\_version\_\_)}
\DoxyCodeLine{732         sys.exit(0)}
\DoxyCodeLine{733 }
\DoxyCodeLine{734     \textcolor{keywordflow}{if} \textcolor{keywordflow}{not} args\_parsed:}
\DoxyCodeLine{735         sys.exit(1)}
\DoxyCodeLine{736 }
\DoxyCodeLine{737     \textcolor{keywordflow}{if} args\_parsed.debug:}
\DoxyCodeLine{738         \mbox{\hyperlink{namespaceklyqa__ctl_1_1general_1_1general_a6e74b8cc4bae98fa55902e4b875af67e}{set\_debug\_logger}}(level=logging.DEBUG)}
\DoxyCodeLine{739 }
\DoxyCodeLine{740     \textcolor{keywordflow}{if} args\_parsed.trace:}
\DoxyCodeLine{741         \mbox{\hyperlink{namespaceklyqa__ctl_1_1general_1_1general_a6e74b8cc4bae98fa55902e4b875af67e}{set\_debug\_logger}}(level=TRACE)}
\DoxyCodeLine{742 }
\DoxyCodeLine{743     \textcolor{keywordflow}{if} args\_parsed.quiet:}
\DoxyCodeLine{744         LOGGER.setLevel(level=logging.CRITICAL)}
\DoxyCodeLine{745         logging\_hdl.setLevel(level=logging.CRITICAL)}
\DoxyCodeLine{746 }
\DoxyCodeLine{747     timeout\_ms: int = DEFAULT\_SEND\_TIMEOUT\_MS}
\DoxyCodeLine{748     \textcolor{keywordflow}{if} args\_parsed.timeout:}
\DoxyCodeLine{749         timeout\_ms = \mbox{\hyperlink{namespacecloud_a8ff77cd5353527f3ef3c4e2216d86949}{int}}(args\_parsed.timeout[0]) * 1000}
\DoxyCodeLine{750 }
\DoxyCodeLine{751     server\_ip: str = args\_parsed.myip[0] \textcolor{keywordflow}{if} args\_parsed.myip \textcolor{keywordflow}{else} \textcolor{stringliteral}{"{}0.0.0.0"{}}}
\DoxyCodeLine{752 }
\DoxyCodeLine{753     client: Client = await Client.create(}
\DoxyCodeLine{754         interactive\_prompts=\textcolor{keyword}{True},}
\DoxyCodeLine{755         offline=args\_parsed.offline,}
\DoxyCodeLine{756         server\_ip=server\_ip,}
\DoxyCodeLine{757     )}
\DoxyCodeLine{758 }
\DoxyCodeLine{759     print\_onboarded\_devices: bool = client.interactive\_prompts}
\DoxyCodeLine{760 }
\DoxyCodeLine{761     print\_onboarded\_devices = (}
\DoxyCodeLine{762         \textcolor{keywordflow}{not} args\_parsed.device\_name}
\DoxyCodeLine{763         \textcolor{keywordflow}{and} \textcolor{keywordflow}{not} args\_parsed.device\_unitids}
\DoxyCodeLine{764         \textcolor{keywordflow}{and} \textcolor{keywordflow}{not} args\_parsed.allDevices}
\DoxyCodeLine{765         \textcolor{keywordflow}{and} \textcolor{keywordflow}{not} args\_parsed.quiet}
\DoxyCodeLine{766     )}
\DoxyCodeLine{767 }
\DoxyCodeLine{768     \textcolor{keywordflow}{if} \textcolor{keywordflow}{not} args\_parsed.offline:}
\DoxyCodeLine{769 }
\DoxyCodeLine{770         \textcolor{keywordflow}{if} args\_parsed.host \textcolor{keywordflow}{and} client.cloud:}
\DoxyCodeLine{771             client.cloud.host = args\_parsed.host[0]}
\DoxyCodeLine{772 }
\DoxyCodeLine{773         \textcolor{comment}{\# if cloud\_backend and not account.access\_token:}}
\DoxyCodeLine{774         \textcolor{comment}{\#     try:}}
\DoxyCodeLine{775         \textcolor{comment}{\#         if await cloud\_backend.login(}}
\DoxyCodeLine{776         \textcolor{comment}{\#             print\_onboarded\_devices=print\_onboarded\_devices}}
\DoxyCodeLine{777         \textcolor{comment}{\#         ):}}
\DoxyCodeLine{778         \textcolor{comment}{\#             task\_log\_debug("{}login finished"{})}}
\DoxyCodeLine{779         \textcolor{comment}{\#             klyqa\_accs[account.username] = account}}
\DoxyCodeLine{780         \textcolor{comment}{\#         else:}}
\DoxyCodeLine{781         \textcolor{comment}{\#             raise Exception()}}
\DoxyCodeLine{782         \textcolor{comment}{\#     except Exception:}}
\DoxyCodeLine{783         \textcolor{comment}{\#         LOGGER.error("{}Error during login."{})}}
\DoxyCodeLine{784         \textcolor{comment}{\#         task\_log\_trace\_ex()}}
\DoxyCodeLine{785         \textcolor{comment}{\#         sys.exit(1)}}
\DoxyCodeLine{786     \textcolor{keywordflow}{if} args\_parsed.dev:}
\DoxyCodeLine{787         \textcolor{keywordflow}{if} args\_parsed.dev:}
\DoxyCodeLine{788             LOGGER.info(\textcolor{stringliteral}{"{}development mode. Using default aes key."{}})}
\DoxyCodeLine{789         print\_onboarded\_devices = \textcolor{keyword}{False}}
\DoxyCodeLine{790 }
\DoxyCodeLine{791     \textcolor{keywordflow}{else}:}
\DoxyCodeLine{792         await client.add\_account(}
\DoxyCodeLine{793             username=args\_parsed.username[0] \textcolor{keywordflow}{if} args\_parsed.username \textcolor{keywordflow}{else} \textcolor{stringliteral}{"{}"{}},}
\DoxyCodeLine{794             password=args\_parsed.password[0] \textcolor{keywordflow}{if} args\_parsed.password \textcolor{keywordflow}{else} \textcolor{stringliteral}{"{}"{}},}
\DoxyCodeLine{795             print\_onboarded\_devices=print\_onboarded\_devices,}
\DoxyCodeLine{796         )}
\DoxyCodeLine{797 }
\DoxyCodeLine{798     exit\_ret = 0}
\DoxyCodeLine{799 }
\DoxyCodeLine{800     \textcolor{keywordflow}{if} args\_parsed.interface \textcolor{keywordflow}{is} \textcolor{keywordflow}{not} \textcolor{keywordtype}{None} \textcolor{keywordflow}{and} client.local:}
\DoxyCodeLine{801         client.local.network\_interface = args\_parsed.interface[0]}
\DoxyCodeLine{802 }
\DoxyCodeLine{803     \textcolor{keywordflow}{if} (}
\DoxyCodeLine{804         await client.send\_to\_devices\_wrapped(}
\DoxyCodeLine{805             args\_parsed, args\_in.copy(), timeout\_ms=timeout\_ms}
\DoxyCodeLine{806         )}
\DoxyCodeLine{807         > 0}
\DoxyCodeLine{808     ):}
\DoxyCodeLine{809         exit\_ret = 1}
\DoxyCodeLine{810 }
\DoxyCodeLine{811     \mbox{\hyperlink{namespaceklyqa__ctl_1_1general_1_1general_a1afe30a73cc28a3b65babeeab27e36c8}{task\_log\_debug}}(\textcolor{stringliteral}{"{}Shutting down.."{}})}
\DoxyCodeLine{812     await client.shutdown()}
\DoxyCodeLine{813 }
\DoxyCodeLine{814     sys.exit(exit\_ret)}
\DoxyCodeLine{815 }
\DoxyCodeLine{816 }

\end{DoxyCode}
Here is the call graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{namespaceklyqa__ctl_1_1klyqa__ctl_afe1b8490f9810b885e4048d7bef472a7_cgraph}
\end{center}
\end{figure}


\doxysubsection{Variable Documentation}
\mbox{\Hypertarget{namespaceklyqa__ctl_1_1klyqa__ctl_ab6c1a4b950d3c6e69d273cbb9a602266}\label{namespaceklyqa__ctl_1_1klyqa__ctl_ab6c1a4b950d3c6e69d273cbb9a602266}} 
\index{klyqa\_ctl.klyqa\_ctl@{klyqa\_ctl.klyqa\_ctl}!AbstractEventLoop@{AbstractEventLoop}}
\index{AbstractEventLoop@{AbstractEventLoop}!klyqa\_ctl.klyqa\_ctl@{klyqa\_ctl.klyqa\_ctl}}
\doxysubsubsection{\texorpdfstring{AbstractEventLoop}{AbstractEventLoop}}
{\footnotesize\ttfamily klyqa\+\_\+ctl.\+klyqa\+\_\+ctl.\+Abstract\+Event\+Loop}

