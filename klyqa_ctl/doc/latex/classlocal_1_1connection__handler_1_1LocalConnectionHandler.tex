\hypertarget{classlocal_1_1connection__handler_1_1LocalConnectionHandler}{}\doxysection{local.\+connection\+\_\+handler.\+Local\+Connection\+Handler Class Reference}
\label{classlocal_1_1connection__handler_1_1LocalConnectionHandler}\index{local.connection\_handler.LocalConnectionHandler@{local.connection\_handler.LocalConnectionHandler}}


Inheritance diagram for local.\+connection\+\_\+handler.\+Local\+Connection\+Handler\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=220pt]{classlocal_1_1connection__handler_1_1LocalConnectionHandler__inherit__graph}
\end{center}
\end{figure}


Collaboration diagram for local.\+connection\+\_\+handler.\+Local\+Connection\+Handler\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=220pt]{classlocal_1_1connection__handler_1_1LocalConnectionHandler__coll__graph}
\end{center}
\end{figure}
\doxysubsection*{Public Member Functions}
\begin{DoxyCompactItemize}
\item 
\mbox{\Hypertarget{classlocal_1_1connection__handler_1_1LocalConnectionHandler_a0c713697632158651e042a125d3a5dc6}\label{classlocal_1_1connection__handler_1_1LocalConnectionHandler_a0c713697632158651e042a125d3a5dc6}} 
None {\bfseries \+\_\+\+\_\+init\+\_\+\+\_\+} (self, \mbox{\hyperlink{classklyqa__ctl_1_1controller__data_1_1ControllerData}{Controller\+Data}} controller\+\_\+data, str server\+\_\+ip=\char`\"{}0.\+0.\+0.\+0\char`\"{}, str$\vert$None network\+\_\+interface=None)
\item 
\mbox{\Hypertarget{classlocal_1_1connection__handler_1_1LocalConnectionHandler_a159e60e3f78301ef89df33d9adaebbde}\label{classlocal_1_1connection__handler_1_1LocalConnectionHandler_a159e60e3f78301ef89df33d9adaebbde}} 
str$\vert$None {\bfseries network\+\_\+interface} (self)
\item 
\mbox{\Hypertarget{classlocal_1_1connection__handler_1_1LocalConnectionHandler_a6ef3ac8849218db44b014909d1f8146a}\label{classlocal_1_1connection__handler_1_1LocalConnectionHandler_a6ef3ac8849218db44b014909d1f8146a}} 
None {\bfseries network\+\_\+interface} (self, str$\vert$None network\+\_\+interface)
\item 
\mbox{\Hypertarget{classlocal_1_1connection__handler_1_1LocalConnectionHandler_a8f938ae53b3c24bbdc02f377671cf263}\label{classlocal_1_1connection__handler_1_1LocalConnectionHandler_a8f938ae53b3c24bbdc02f377671cf263}} 
\mbox{\hyperlink{classklyqa__ctl_1_1controller__data_1_1ControllerData}{Controller\+Data}} {\bfseries controller\+\_\+data} (self)
\item 
\mbox{\Hypertarget{classlocal_1_1connection__handler_1_1LocalConnectionHandler_ac7312a0c1fbe8ad9bcbd585e66e9e74c}\label{classlocal_1_1connection__handler_1_1LocalConnectionHandler_ac7312a0c1fbe8ad9bcbd585e66e9e74c}} 
None {\bfseries controller\+\_\+data} (self, \mbox{\hyperlink{classklyqa__ctl_1_1controller__data_1_1ControllerData}{Controller\+Data}} controller\+\_\+data)
\item 
\mbox{\Hypertarget{classlocal_1_1connection__handler_1_1LocalConnectionHandler_a4d307f6bd0b66f3cb9fac3057fc87972}\label{classlocal_1_1connection__handler_1_1LocalConnectionHandler_a4d307f6bd0b66f3cb9fac3057fc87972}} 
dict\mbox{[}str, \mbox{\hyperlink{classklyqa__ctl_1_1devices_1_1device_1_1Device}{Device}}\mbox{]} {\bfseries devices} (self)
\item 
\mbox{\Hypertarget{classlocal_1_1connection__handler_1_1LocalConnectionHandler_a8d7418a9f89b4622dd814bd1c9ea4028}\label{classlocal_1_1connection__handler_1_1LocalConnectionHandler_a8d7418a9f89b4622dd814bd1c9ea4028}} 
None {\bfseries devices} (self, dict\mbox{[}str, \mbox{\hyperlink{classklyqa__ctl_1_1devices_1_1device_1_1Device}{Device}}\mbox{]} devices)
\item 
\mbox{\Hypertarget{classlocal_1_1connection__handler_1_1LocalConnectionHandler_a00d69811c9433020eb1ec3b24383008e}\label{classlocal_1_1connection__handler_1_1LocalConnectionHandler_a00d69811c9433020eb1ec3b24383008e}} 
socket.\+socket$\vert$None {\bfseries tcp} (self)
\item 
\mbox{\Hypertarget{classlocal_1_1connection__handler_1_1LocalConnectionHandler_a0f8caa333a22c79922997c34d9d7b868}\label{classlocal_1_1connection__handler_1_1LocalConnectionHandler_a0f8caa333a22c79922997c34d9d7b868}} 
None {\bfseries tcp} (self, socket.\+socket$\vert$None tcp)
\item 
\mbox{\Hypertarget{classlocal_1_1connection__handler_1_1LocalConnectionHandler_a9ff5b865c574faa82b43f8578b0bd564}\label{classlocal_1_1connection__handler_1_1LocalConnectionHandler_a9ff5b865c574faa82b43f8578b0bd564}} 
socket.\+socket$\vert$None {\bfseries udp} (self)
\item 
\mbox{\Hypertarget{classlocal_1_1connection__handler_1_1LocalConnectionHandler_a577fb1c5fd541b50f25314acf0f9ee84}\label{classlocal_1_1connection__handler_1_1LocalConnectionHandler_a577fb1c5fd541b50f25314acf0f9ee84}} 
None {\bfseries udp} (self, socket.\+socket$\vert$None udp)
\item 
\mbox{\Hypertarget{classlocal_1_1connection__handler_1_1LocalConnectionHandler_ab8a8460610614f6230bbf346fc532269}\label{classlocal_1_1connection__handler_1_1LocalConnectionHandler_ab8a8460610614f6230bbf346fc532269}} 
str {\bfseries server\+\_\+ip} (self)
\item 
\mbox{\Hypertarget{classlocal_1_1connection__handler_1_1LocalConnectionHandler_aebdf9201096932f18c4f28e1e084d267}\label{classlocal_1_1connection__handler_1_1LocalConnectionHandler_aebdf9201096932f18c4f28e1e084d267}} 
None {\bfseries server\+\_\+ip} (self, str server\+\_\+ip)
\item 
\mbox{\Hypertarget{classlocal_1_1connection__handler_1_1LocalConnectionHandler_a2c8ccb41ccfd636bd8a02042034375e8}\label{classlocal_1_1connection__handler_1_1LocalConnectionHandler_a2c8ccb41ccfd636bd8a02042034375e8}} 
dict\mbox{[}str, list\mbox{[}\mbox{\hyperlink{classklyqa__ctl_1_1general_1_1message_1_1Message}{Message}}\mbox{]}\mbox{]} {\bfseries message\+\_\+queue} (self)
\item 
\mbox{\Hypertarget{classlocal_1_1connection__handler_1_1LocalConnectionHandler_a1fc09795d2fca9fcaf4ef67f48810ce2}\label{classlocal_1_1connection__handler_1_1LocalConnectionHandler_a1fc09795d2fca9fcaf4ef67f48810ce2}} 
None {\bfseries message\+\_\+queue} (self, dict\mbox{[}str, list\mbox{[}\mbox{\hyperlink{classklyqa__ctl_1_1general_1_1message_1_1Message}{Message}}\mbox{]}\mbox{]} message\+\_\+queue)
\item 
\mbox{\Hypertarget{classlocal_1_1connection__handler_1_1LocalConnectionHandler_a7e62dc20801dc3d832dbd1dd0373ba17}\label{classlocal_1_1connection__handler_1_1LocalConnectionHandler_a7e62dc20801dc3d832dbd1dd0373ba17}} 
Task$\vert$None {\bfseries handle\+\_\+connections\+\_\+task} (self)
\item 
\mbox{\Hypertarget{classlocal_1_1connection__handler_1_1LocalConnectionHandler_a44ce408a0cb35854a4ac1dfe541090b4}\label{classlocal_1_1connection__handler_1_1LocalConnectionHandler_a44ce408a0cb35854a4ac1dfe541090b4}} 
None {\bfseries handle\+\_\+connections\+\_\+task} (self, Task$\vert$None handle\+\_\+connections\+\_\+tasks)
\item 
\mbox{\Hypertarget{classlocal_1_1connection__handler_1_1LocalConnectionHandler_acf31322d19d937f12f736c7f4c3d9f22}\label{classlocal_1_1connection__handler_1_1LocalConnectionHandler_acf31322d19d937f12f736c7f4c3d9f22}} 
bool {\bfseries handle\+\_\+connections\+\_\+task\+\_\+end\+\_\+now} (self)
\item 
\mbox{\Hypertarget{classlocal_1_1connection__handler_1_1LocalConnectionHandler_ac2ea1078fc435b2f80b549c4d17ab6d4}\label{classlocal_1_1connection__handler_1_1LocalConnectionHandler_ac2ea1078fc435b2f80b549c4d17ab6d4}} 
None {\bfseries handle\+\_\+connections\+\_\+task\+\_\+end\+\_\+now} (self, bool handle\+\_\+connections\+\_\+task\+\_\+end\+\_\+now)
\item 
\mbox{\Hypertarget{classlocal_1_1connection__handler_1_1LocalConnectionHandler_a7e5e94d8da70d86c87eba78bcde9ff42}\label{classlocal_1_1connection__handler_1_1LocalConnectionHandler_a7e5e94d8da70d86c87eba78bcde9ff42}} 
set\mbox{[}str\mbox{]} {\bfseries current\+\_\+addr\+\_\+connections} (self)
\item 
\mbox{\Hypertarget{classlocal_1_1connection__handler_1_1LocalConnectionHandler_a5c2443c4a93b9bfedd207119b0dbb9bc}\label{classlocal_1_1connection__handler_1_1LocalConnectionHandler_a5c2443c4a93b9bfedd207119b0dbb9bc}} 
None {\bfseries current\+\_\+addr\+\_\+connections} (self, set\mbox{[}str\mbox{]} current\+\_\+addr\+\_\+connections)
\item 
\mbox{\Hypertarget{classlocal_1_1connection__handler_1_1LocalConnectionHandler_a3510d32dbcb1a08fcd7796e2d8d2bdd6}\label{classlocal_1_1connection__handler_1_1LocalConnectionHandler_a3510d32dbcb1a08fcd7796e2d8d2bdd6}} 
None {\bfseries shutdown} (self)
\item 
bool \mbox{\hyperlink{classlocal_1_1connection__handler_1_1LocalConnectionHandler_a28f05e11005dfc83e537f9e2e85f54d5}{bind\+\_\+ports}} (self)
\item 
Device\+Tcp\+Return \mbox{\hyperlink{classlocal_1_1connection__handler_1_1LocalConnectionHandler_a4ce11db96280d000941a91cb37df2842}{process\+\_\+device\+\_\+identity\+\_\+package}} (self, Tcp\+Connection connection, bytes data, \mbox{\hyperlink{classklyqa__ctl_1_1general_1_1general_1_1ReferencePass}{Reference\+Pass}} device\+\_\+ref)
\item 
Device\+Tcp\+Return \mbox{\hyperlink{classlocal_1_1connection__handler_1_1LocalConnectionHandler_ad1b4bfaedd513acfccbf1b12e36d5469}{process\+\_\+aes\+\_\+initial\+\_\+vector\+\_\+package}} (self, Tcp\+Connection connection, bytes data, \mbox{\hyperlink{classklyqa__ctl_1_1devices_1_1device_1_1Device}{Device}} device)
\item 
Device\+Tcp\+Return \mbox{\hyperlink{classlocal_1_1connection__handler_1_1LocalConnectionHandler_a46f68728bc59f0e5991bc390f67f2685}{process\+\_\+message\+\_\+answer\+\_\+package}} (self, Tcp\+Connection connection, bytes answer, \mbox{\hyperlink{classklyqa__ctl_1_1devices_1_1device_1_1Device}{Device}} device, \mbox{\hyperlink{classklyqa__ctl_1_1general_1_1message_1_1Message}{Message}}$\vert$None msg\+\_\+sent)
\item 
\mbox{\Hypertarget{classlocal_1_1connection__handler_1_1LocalConnectionHandler_a34b95b45332382bb830a3f1277878268}\label{classlocal_1_1connection__handler_1_1LocalConnectionHandler_a34b95b45332382bb830a3f1277878268}} 
None {\bfseries remove\+\_\+msg\+\_\+from\+\_\+queue} (self, \mbox{\hyperlink{classklyqa__ctl_1_1general_1_1message_1_1Message}{Message}} msg, \mbox{\hyperlink{classklyqa__ctl_1_1devices_1_1device_1_1Device}{Device}}$\vert$None device)
\item 
Device\+Tcp\+Return \mbox{\hyperlink{classlocal_1_1connection__handler_1_1LocalConnectionHandler_a900e05554022ee9ecb3ba5621369016d}{handle\+\_\+connection}} (self, \mbox{\hyperlink{classklyqa__ctl_1_1general_1_1general_1_1ReferencePass}{Reference\+Pass}} device\+\_\+ref, Tcp\+Connection connection, \mbox{\hyperlink{classklyqa__ctl_1_1general_1_1general_1_1ReferencePass}{Reference\+Pass}} msg\+\_\+sent\+\_\+r)
\item 
Device\+Tcp\+Return \mbox{\hyperlink{classlocal_1_1connection__handler_1_1LocalConnectionHandler_aaa28266e241c2e30e8acd468fab06fde}{process\+\_\+tcp\+\_\+package}} (self, Tcp\+Connection connection, \mbox{\hyperlink{classklyqa__ctl_1_1general_1_1general_1_1ReferencePass}{Reference\+Pass}} data\+\_\+ref, \mbox{\hyperlink{classklyqa__ctl_1_1general_1_1message_1_1Message}{Message}}$\vert$None msg\+\_\+sent, \mbox{\hyperlink{classklyqa__ctl_1_1general_1_1general_1_1ReferencePass}{Reference\+Pass}} device\+\_\+ref)
\item 
\mbox{\Hypertarget{classlocal_1_1connection__handler_1_1LocalConnectionHandler_a0b582d0bf1523d1d0404867ab921539f}\label{classlocal_1_1connection__handler_1_1LocalConnectionHandler_a0b582d0bf1523d1d0404867ab921539f}} 
Device\+Tcp\+Return \mbox{\hyperlink{classlocal_1_1connection__handler_1_1LocalConnectionHandler_a0b582d0bf1523d1d0404867ab921539f}{device\+\_\+handle\+\_\+local\+\_\+tcp}} (self, \mbox{\hyperlink{classklyqa__ctl_1_1devices_1_1device_1_1Device}{Device}} device, Tcp\+Connection connection)
\begin{DoxyCompactList}\small\item\em Handle the incoming tcp connection to the device. \end{DoxyCompactList}\item 
bool \mbox{\hyperlink{classlocal_1_1connection__handler_1_1LocalConnectionHandler_a69a2aabf1a7bc94f925f914df5ceae10}{send\+\_\+udp\+\_\+broadcast}} (self)
\item 
None \mbox{\hyperlink{classlocal_1_1connection__handler_1_1LocalConnectionHandler_aed3640a60ff23b9532ca91ebd2a9d01a}{standby}} (self)
\item 
\mbox{\Hypertarget{classlocal_1_1connection__handler_1_1LocalConnectionHandler_aa6b6ea4bb56f4c18b6906bab38c971a7}\label{classlocal_1_1connection__handler_1_1LocalConnectionHandler_aa6b6ea4bb56f4c18b6906bab38c971a7}} 
tuple\mbox{[}list\mbox{[}Any\mbox{]}, list\mbox{[}Any\mbox{]}, list\mbox{[}Any\mbox{]}\mbox{]}$\vert$None {\bfseries read\+\_\+incoming\+\_\+tcp\+\_\+con\+\_\+task} (self)
\item 
None \mbox{\hyperlink{classlocal_1_1connection__handler_1_1LocalConnectionHandler_a8b85c27ecdc845a205a4f36c38554ec8}{check\+\_\+messages\+\_\+time\+\_\+to\+\_\+live}} (self)
\item 
None \mbox{\hyperlink{classlocal_1_1connection__handler_1_1LocalConnectionHandler_aefd29b1e670e7076b749f7f21b0dc290}{connection\+\_\+tasks\+\_\+time\+\_\+to\+\_\+live}} (self, int proc\+\_\+timeout\+\_\+secs=DEFAULT\+\_\+\+MAX\+\_\+\+COM\+\_\+\+PROC\+\_\+\+TIMEOUT\+\_\+\+SECS)
\item 
None \mbox{\hyperlink{classlocal_1_1connection__handler_1_1LocalConnectionHandler_a5e9277acd0b7bfa5a1e74417e0e10d86}{handle\+\_\+incoming\+\_\+tcp\+\_\+connection}} (self, int proc\+\_\+timeout\+\_\+secs)
\item 
bool \mbox{\hyperlink{classlocal_1_1connection__handler_1_1LocalConnectionHandler_aa5d34422c7cb1784e408fef186a0b585}{handle\+\_\+connections}} (self, int proc\+\_\+timeout\+\_\+secs=DEFAULT\+\_\+\+MAX\+\_\+\+COM\+\_\+\+PROC\+\_\+\+TIMEOUT\+\_\+\+SECS)
\begin{DoxyCompactList}\small\item\em Send broadcast and make tasks for incoming tcp connections. \end{DoxyCompactList}\item 
None \mbox{\hyperlink{classlocal_1_1connection__handler_1_1LocalConnectionHandler_aa780e39d1ce443d422a41064cc382d1f}{handle\+\_\+connections\+\_\+task\+\_\+stop}} (self)
\item 
None \mbox{\hyperlink{classlocal_1_1connection__handler_1_1LocalConnectionHandler_ae9be93d47c973e3c8afeed1b27fc7a4d}{search\+\_\+and\+\_\+send\+\_\+loop\+\_\+task\+\_\+alive}} (self)
\item 
\mbox{\hyperlink{classklyqa__ctl_1_1general_1_1message_1_1Message}{Message}}$\vert$None \mbox{\hyperlink{classlocal_1_1connection__handler_1_1LocalConnectionHandler_aae9d106df606f3c68a146e0af7f60bba}{send\+\_\+message}} (self, list\mbox{[}\mbox{\hyperlink{classklyqa__ctl_1_1general_1_1general_1_1Command}{Command}}\mbox{]} send\+\_\+msgs, \mbox{\hyperlink{classklyqa__ctl_1_1general_1_1unit__id_1_1UnitId}{Unit\+Id}} target\+\_\+device\+\_\+uid, float time\+\_\+to\+\_\+live\+\_\+secs=-\/1.\+0, $\ast$$\ast$Any kwargs)
\item 
None \mbox{\hyperlink{classlocal_1_1connection__handler_1_1LocalConnectionHandler_af714f4a1c0791c62d2d3990990a42cf4}{discover\+\_\+devices}} (self, float timeout\+\_\+secs=2.\+5)
\item 
\mbox{\hyperlink{classlocal_1_1connection__handler_1_1LocalConnectionHandler}{Local\+Connection\+Handler}} \mbox{\hyperlink{classlocal_1_1connection__handler_1_1LocalConnectionHandler_ad2b49f5fff5ca621ba06840d5f550666}{create\+\_\+default}} (Any cls, \mbox{\hyperlink{classklyqa__ctl_1_1controller__data_1_1ControllerData}{Controller\+Data}} controller\+\_\+data, str server\+\_\+ip=\char`\"{}0.\+0.\+0.\+0\char`\"{}, str$\vert$None network\+\_\+interface=None)
\end{DoxyCompactItemize}
\doxysubsection*{Public Attributes}
\begin{DoxyCompactItemize}
\item 
\mbox{\Hypertarget{classlocal_1_1connection__handler_1_1LocalConnectionHandler_a06a29b1bf1327ddeb687e4062ee1110d}\label{classlocal_1_1connection__handler_1_1LocalConnectionHandler_a06a29b1bf1327ddeb687e4062ee1110d}} 
{\bfseries tcp}
\item 
\mbox{\Hypertarget{classlocal_1_1connection__handler_1_1LocalConnectionHandler_a8707b5729524d2c0a4e5e1b2116d22c2}\label{classlocal_1_1connection__handler_1_1LocalConnectionHandler_a8707b5729524d2c0a4e5e1b2116d22c2}} 
{\bfseries udp}
\item 
\mbox{\Hypertarget{classlocal_1_1connection__handler_1_1LocalConnectionHandler_aa8d21a3d613da986068dc05e8ea8c4a7}\label{classlocal_1_1connection__handler_1_1LocalConnectionHandler_aa8d21a3d613da986068dc05e8ea8c4a7}} 
{\bfseries message\+\_\+queue}
\item 
\mbox{\Hypertarget{classlocal_1_1connection__handler_1_1LocalConnectionHandler_a828ca7aef56188a7dd4bd1b18b7cea85}\label{classlocal_1_1connection__handler_1_1LocalConnectionHandler_a828ca7aef56188a7dd4bd1b18b7cea85}} 
{\bfseries handle\+\_\+connections\+\_\+task\+\_\+end\+\_\+now}
\item 
\mbox{\Hypertarget{classlocal_1_1connection__handler_1_1LocalConnectionHandler_ac3bb2f33c3dd9a46ba505569ec001ab3}\label{classlocal_1_1connection__handler_1_1LocalConnectionHandler_ac3bb2f33c3dd9a46ba505569ec001ab3}} 
{\bfseries msg\+\_\+ttl\+\_\+task}
\item 
\mbox{\Hypertarget{classlocal_1_1connection__handler_1_1LocalConnectionHandler_a1f5deccf8a67169afa7e67c53cd569e5}\label{classlocal_1_1connection__handler_1_1LocalConnectionHandler_a1f5deccf8a67169afa7e67c53cd569e5}} 
{\bfseries handle\+\_\+connections\+\_\+task}
\end{DoxyCompactItemize}


\doxysubsection{Detailed Description}
\begin{DoxyVerb}Data communicator for local device connection.

Important: Call async function shutdown() after using send method,
or the send message loop will keep running.\end{DoxyVerb}
 

\doxysubsection{Member Function Documentation}
\mbox{\Hypertarget{classlocal_1_1connection__handler_1_1LocalConnectionHandler_a28f05e11005dfc83e537f9e2e85f54d5}\label{classlocal_1_1connection__handler_1_1LocalConnectionHandler_a28f05e11005dfc83e537f9e2e85f54d5}} 
\index{local.connection\_handler.LocalConnectionHandler@{local.connection\_handler.LocalConnectionHandler}!bind\_ports@{bind\_ports}}
\index{bind\_ports@{bind\_ports}!local.connection\_handler.LocalConnectionHandler@{local.connection\_handler.LocalConnectionHandler}}
\doxysubsubsection{\texorpdfstring{bind\_ports()}{bind\_ports()}}
{\footnotesize\ttfamily  bool local.\+connection\+\_\+handler.\+Local\+Connection\+Handler.\+bind\+\_\+ports (\begin{DoxyParamCaption}\item[{}]{self }\end{DoxyParamCaption})}

\begin{DoxyVerb}bind ports.\end{DoxyVerb}
 \mbox{\Hypertarget{classlocal_1_1connection__handler_1_1LocalConnectionHandler_a8b85c27ecdc845a205a4f36c38554ec8}\label{classlocal_1_1connection__handler_1_1LocalConnectionHandler_a8b85c27ecdc845a205a4f36c38554ec8}} 
\index{local.connection\_handler.LocalConnectionHandler@{local.connection\_handler.LocalConnectionHandler}!check\_messages\_time\_to\_live@{check\_messages\_time\_to\_live}}
\index{check\_messages\_time\_to\_live@{check\_messages\_time\_to\_live}!local.connection\_handler.LocalConnectionHandler@{local.connection\_handler.LocalConnectionHandler}}
\doxysubsubsection{\texorpdfstring{check\_messages\_time\_to\_live()}{check\_messages\_time\_to\_live()}}
{\footnotesize\ttfamily  None local.\+connection\+\_\+handler.\+Local\+Connection\+Handler.\+check\+\_\+messages\+\_\+time\+\_\+to\+\_\+live (\begin{DoxyParamCaption}\item[{}]{self }\end{DoxyParamCaption})}

\begin{DoxyVerb}Check message queue for end of live messages.\end{DoxyVerb}
 \mbox{\Hypertarget{classlocal_1_1connection__handler_1_1LocalConnectionHandler_aefd29b1e670e7076b749f7f21b0dc290}\label{classlocal_1_1connection__handler_1_1LocalConnectionHandler_aefd29b1e670e7076b749f7f21b0dc290}} 
\index{local.connection\_handler.LocalConnectionHandler@{local.connection\_handler.LocalConnectionHandler}!connection\_tasks\_time\_to\_live@{connection\_tasks\_time\_to\_live}}
\index{connection\_tasks\_time\_to\_live@{connection\_tasks\_time\_to\_live}!local.connection\_handler.LocalConnectionHandler@{local.connection\_handler.LocalConnectionHandler}}
\doxysubsubsection{\texorpdfstring{connection\_tasks\_time\_to\_live()}{connection\_tasks\_time\_to\_live()}}
{\footnotesize\ttfamily  None local.\+connection\+\_\+handler.\+Local\+Connection\+Handler.\+connection\+\_\+tasks\+\_\+time\+\_\+to\+\_\+live (\begin{DoxyParamCaption}\item[{}]{self,  }\item[{int }]{proc\+\_\+timeout\+\_\+secs = {\ttfamily DEFAULT\+\_\+MAX\+\_\+COM\+\_\+PROC\+\_\+TIMEOUT\+\_\+SECS} }\end{DoxyParamCaption})}

\begin{DoxyVerb}End connection tasks with run out time to live.\end{DoxyVerb}
 \mbox{\Hypertarget{classlocal_1_1connection__handler_1_1LocalConnectionHandler_ad2b49f5fff5ca621ba06840d5f550666}\label{classlocal_1_1connection__handler_1_1LocalConnectionHandler_ad2b49f5fff5ca621ba06840d5f550666}} 
\index{local.connection\_handler.LocalConnectionHandler@{local.connection\_handler.LocalConnectionHandler}!create\_default@{create\_default}}
\index{create\_default@{create\_default}!local.connection\_handler.LocalConnectionHandler@{local.connection\_handler.LocalConnectionHandler}}
\doxysubsubsection{\texorpdfstring{create\_default()}{create\_default()}}
{\footnotesize\ttfamily  \mbox{\hyperlink{classlocal_1_1connection__handler_1_1LocalConnectionHandler}{Local\+Connection\+Handler}} local.\+connection\+\_\+handler.\+Local\+Connection\+Handler.\+create\+\_\+default (\begin{DoxyParamCaption}\item[{Any}]{cls,  }\item[{\mbox{\hyperlink{classklyqa__ctl_1_1controller__data_1_1ControllerData}{Controller\+Data}}}]{controller\+\_\+data,  }\item[{str }]{server\+\_\+ip = {\ttfamily \char`\"{}0.0.0.0\char`\"{}},  }\item[{str $\vert$ None }]{network\+\_\+interface = {\ttfamily None} }\end{DoxyParamCaption})}

\begin{DoxyVerb}Factory for local only controller.\end{DoxyVerb}
 \mbox{\Hypertarget{classlocal_1_1connection__handler_1_1LocalConnectionHandler_af714f4a1c0791c62d2d3990990a42cf4}\label{classlocal_1_1connection__handler_1_1LocalConnectionHandler_af714f4a1c0791c62d2d3990990a42cf4}} 
\index{local.connection\_handler.LocalConnectionHandler@{local.connection\_handler.LocalConnectionHandler}!discover\_devices@{discover\_devices}}
\index{discover\_devices@{discover\_devices}!local.connection\_handler.LocalConnectionHandler@{local.connection\_handler.LocalConnectionHandler}}
\doxysubsubsection{\texorpdfstring{discover\_devices()}{discover\_devices()}}
{\footnotesize\ttfamily  None local.\+connection\+\_\+handler.\+Local\+Connection\+Handler.\+discover\+\_\+devices (\begin{DoxyParamCaption}\item[{}]{self,  }\item[{float }]{timeout\+\_\+secs = {\ttfamily 2.5} }\end{DoxyParamCaption})}

\begin{DoxyVerb}Discover devices.\end{DoxyVerb}
 \mbox{\Hypertarget{classlocal_1_1connection__handler_1_1LocalConnectionHandler_a900e05554022ee9ecb3ba5621369016d}\label{classlocal_1_1connection__handler_1_1LocalConnectionHandler_a900e05554022ee9ecb3ba5621369016d}} 
\index{local.connection\_handler.LocalConnectionHandler@{local.connection\_handler.LocalConnectionHandler}!handle\_connection@{handle\_connection}}
\index{handle\_connection@{handle\_connection}!local.connection\_handler.LocalConnectionHandler@{local.connection\_handler.LocalConnectionHandler}}
\doxysubsubsection{\texorpdfstring{handle\_connection()}{handle\_connection()}}
{\footnotesize\ttfamily  Device\+Tcp\+Return local.\+connection\+\_\+handler.\+Local\+Connection\+Handler.\+handle\+\_\+connection (\begin{DoxyParamCaption}\item[{}]{self,  }\item[{\mbox{\hyperlink{classklyqa__ctl_1_1general_1_1general_1_1ReferencePass}{Reference\+Pass}}}]{device\+\_\+ref,  }\item[{Tcp\+Connection}]{connection,  }\item[{\mbox{\hyperlink{classklyqa__ctl_1_1general_1_1general_1_1ReferencePass}{Reference\+Pass}}}]{msg\+\_\+sent\+\_\+r }\end{DoxyParamCaption})}

\begin{DoxyVerb}FIX: return type! sometimes return value sometimes tuple...

Finish AES handshake.
Getting the identity of the device.
Send the commands in message queue to the device with the device u_id
or to any device.

Params:
    device: Device - (initial) device object with the tcp connection
    target_device_uid - If given device_uid only send commands when
        the device unit id equals the target_device_uid
    discover_mode - if True do the process to any device unit id.

Returns: tuple[int, dict] or tuple[int, str]
    dict: Json response of the device
    str: Error string message
    int: Error type
        0 - success - no error
        1 - on error
        2 - not correct device uid
        3 - tcp connection ended, shall retry
        4 - error on reading response message from device, shall retry
        5 - error getting lock for device, shall retry
        6 - missing aes key
        7 - value not valid for device config\end{DoxyVerb}
 \mbox{\Hypertarget{classlocal_1_1connection__handler_1_1LocalConnectionHandler_aa5d34422c7cb1784e408fef186a0b585}\label{classlocal_1_1connection__handler_1_1LocalConnectionHandler_aa5d34422c7cb1784e408fef186a0b585}} 
\index{local.connection\_handler.LocalConnectionHandler@{local.connection\_handler.LocalConnectionHandler}!handle\_connections@{handle\_connections}}
\index{handle\_connections@{handle\_connections}!local.connection\_handler.LocalConnectionHandler@{local.connection\_handler.LocalConnectionHandler}}
\doxysubsubsection{\texorpdfstring{handle\_connections()}{handle\_connections()}}
{\footnotesize\ttfamily  bool local.\+connection\+\_\+handler.\+Local\+Connection\+Handler.\+handle\+\_\+connections (\begin{DoxyParamCaption}\item[{}]{self,  }\item[{int }]{proc\+\_\+timeout\+\_\+secs = {\ttfamily DEFAULT\+\_\+MAX\+\_\+COM\+\_\+PROC\+\_\+TIMEOUT\+\_\+SECS} }\end{DoxyParamCaption})}



Send broadcast and make tasks for incoming tcp connections. 

\begin{DoxyVerb}   Params:
       proc_timeout_secs: max timeout in seconds for a device
           communication handle process

   Returns:
       true:  on success
       false: on exception or error
\end{DoxyVerb}
 \mbox{\Hypertarget{classlocal_1_1connection__handler_1_1LocalConnectionHandler_aa780e39d1ce443d422a41064cc382d1f}\label{classlocal_1_1connection__handler_1_1LocalConnectionHandler_aa780e39d1ce443d422a41064cc382d1f}} 
\index{local.connection\_handler.LocalConnectionHandler@{local.connection\_handler.LocalConnectionHandler}!handle\_connections\_task\_stop@{handle\_connections\_task\_stop}}
\index{handle\_connections\_task\_stop@{handle\_connections\_task\_stop}!local.connection\_handler.LocalConnectionHandler@{local.connection\_handler.LocalConnectionHandler}}
\doxysubsubsection{\texorpdfstring{handle\_connections\_task\_stop()}{handle\_connections\_task\_stop()}}
{\footnotesize\ttfamily  None local.\+connection\+\_\+handler.\+Local\+Connection\+Handler.\+handle\+\_\+connections\+\_\+task\+\_\+stop (\begin{DoxyParamCaption}\item[{}]{self }\end{DoxyParamCaption})}

\begin{DoxyVerb}End device search and connections handler task.\end{DoxyVerb}
 \mbox{\Hypertarget{classlocal_1_1connection__handler_1_1LocalConnectionHandler_a5e9277acd0b7bfa5a1e74417e0e10d86}\label{classlocal_1_1connection__handler_1_1LocalConnectionHandler_a5e9277acd0b7bfa5a1e74417e0e10d86}} 
\index{local.connection\_handler.LocalConnectionHandler@{local.connection\_handler.LocalConnectionHandler}!handle\_incoming\_tcp\_connection@{handle\_incoming\_tcp\_connection}}
\index{handle\_incoming\_tcp\_connection@{handle\_incoming\_tcp\_connection}!local.connection\_handler.LocalConnectionHandler@{local.connection\_handler.LocalConnectionHandler}}
\doxysubsubsection{\texorpdfstring{handle\_incoming\_tcp\_connection()}{handle\_incoming\_tcp\_connection()}}
{\footnotesize\ttfamily  None local.\+connection\+\_\+handler.\+Local\+Connection\+Handler.\+handle\+\_\+incoming\+\_\+tcp\+\_\+connection (\begin{DoxyParamCaption}\item[{}]{self,  }\item[{int     }]{proc\+\_\+timeout\+\_\+secs }\end{DoxyParamCaption})}

\begin{DoxyVerb}Accept incoming tcp connection and start connection handle
process.\end{DoxyVerb}
 \mbox{\Hypertarget{classlocal_1_1connection__handler_1_1LocalConnectionHandler_ad1b4bfaedd513acfccbf1b12e36d5469}\label{classlocal_1_1connection__handler_1_1LocalConnectionHandler_ad1b4bfaedd513acfccbf1b12e36d5469}} 
\index{local.connection\_handler.LocalConnectionHandler@{local.connection\_handler.LocalConnectionHandler}!process\_aes\_initial\_vector\_package@{process\_aes\_initial\_vector\_package}}
\index{process\_aes\_initial\_vector\_package@{process\_aes\_initial\_vector\_package}!local.connection\_handler.LocalConnectionHandler@{local.connection\_handler.LocalConnectionHandler}}
\doxysubsubsection{\texorpdfstring{process\_aes\_initial\_vector\_package()}{process\_aes\_initial\_vector\_package()}}
{\footnotesize\ttfamily  Device\+Tcp\+Return local.\+connection\+\_\+handler.\+Local\+Connection\+Handler.\+process\+\_\+aes\+\_\+initial\+\_\+vector\+\_\+package (\begin{DoxyParamCaption}\item[{}]{self,  }\item[{Tcp\+Connection}]{connection,  }\item[{bytes}]{data,  }\item[{\mbox{\hyperlink{classklyqa__ctl_1_1devices_1_1device_1_1Device}{Device}}     }]{device }\end{DoxyParamCaption})}

\begin{DoxyVerb}Create the AES encryption and decryption objects.\end{DoxyVerb}
 \mbox{\Hypertarget{classlocal_1_1connection__handler_1_1LocalConnectionHandler_a4ce11db96280d000941a91cb37df2842}\label{classlocal_1_1connection__handler_1_1LocalConnectionHandler_a4ce11db96280d000941a91cb37df2842}} 
\index{local.connection\_handler.LocalConnectionHandler@{local.connection\_handler.LocalConnectionHandler}!process\_device\_identity\_package@{process\_device\_identity\_package}}
\index{process\_device\_identity\_package@{process\_device\_identity\_package}!local.connection\_handler.LocalConnectionHandler@{local.connection\_handler.LocalConnectionHandler}}
\doxysubsubsection{\texorpdfstring{process\_device\_identity\_package()}{process\_device\_identity\_package()}}
{\footnotesize\ttfamily  Device\+Tcp\+Return local.\+connection\+\_\+handler.\+Local\+Connection\+Handler.\+process\+\_\+device\+\_\+identity\+\_\+package (\begin{DoxyParamCaption}\item[{}]{self,  }\item[{Tcp\+Connection}]{connection,  }\item[{bytes}]{data,  }\item[{\mbox{\hyperlink{classklyqa__ctl_1_1general_1_1general_1_1ReferencePass}{Reference\+Pass}}}]{device\+\_\+ref }\end{DoxyParamCaption})}

\begin{DoxyVerb}Process the device identity package.\end{DoxyVerb}
 \mbox{\Hypertarget{classlocal_1_1connection__handler_1_1LocalConnectionHandler_a46f68728bc59f0e5991bc390f67f2685}\label{classlocal_1_1connection__handler_1_1LocalConnectionHandler_a46f68728bc59f0e5991bc390f67f2685}} 
\index{local.connection\_handler.LocalConnectionHandler@{local.connection\_handler.LocalConnectionHandler}!process\_message\_answer\_package@{process\_message\_answer\_package}}
\index{process\_message\_answer\_package@{process\_message\_answer\_package}!local.connection\_handler.LocalConnectionHandler@{local.connection\_handler.LocalConnectionHandler}}
\doxysubsubsection{\texorpdfstring{process\_message\_answer\_package()}{process\_message\_answer\_package()}}
{\footnotesize\ttfamily  Device\+Tcp\+Return local.\+connection\+\_\+handler.\+Local\+Connection\+Handler.\+process\+\_\+message\+\_\+answer\+\_\+package (\begin{DoxyParamCaption}\item[{}]{self,  }\item[{Tcp\+Connection}]{connection,  }\item[{bytes}]{answer,  }\item[{\mbox{\hyperlink{classklyqa__ctl_1_1devices_1_1device_1_1Device}{Device}}}]{device,  }\item[{\mbox{\hyperlink{classklyqa__ctl_1_1general_1_1message_1_1Message}{Message}} $\vert$ None}]{msg\+\_\+sent }\end{DoxyParamCaption})}

\begin{DoxyVerb}Process the encrypted device answer.\end{DoxyVerb}
 \mbox{\Hypertarget{classlocal_1_1connection__handler_1_1LocalConnectionHandler_aaa28266e241c2e30e8acd468fab06fde}\label{classlocal_1_1connection__handler_1_1LocalConnectionHandler_aaa28266e241c2e30e8acd468fab06fde}} 
\index{local.connection\_handler.LocalConnectionHandler@{local.connection\_handler.LocalConnectionHandler}!process\_tcp\_package@{process\_tcp\_package}}
\index{process\_tcp\_package@{process\_tcp\_package}!local.connection\_handler.LocalConnectionHandler@{local.connection\_handler.LocalConnectionHandler}}
\doxysubsubsection{\texorpdfstring{process\_tcp\_package()}{process\_tcp\_package()}}
{\footnotesize\ttfamily  Device\+Tcp\+Return local.\+connection\+\_\+handler.\+Local\+Connection\+Handler.\+process\+\_\+tcp\+\_\+package (\begin{DoxyParamCaption}\item[{}]{self,  }\item[{Tcp\+Connection}]{connection,  }\item[{\mbox{\hyperlink{classklyqa__ctl_1_1general_1_1general_1_1ReferencePass}{Reference\+Pass}}}]{data\+\_\+ref,  }\item[{\mbox{\hyperlink{classklyqa__ctl_1_1general_1_1message_1_1Message}{Message}} $\vert$ None}]{msg\+\_\+sent,  }\item[{\mbox{\hyperlink{classklyqa__ctl_1_1general_1_1general_1_1ReferencePass}{Reference\+Pass}}}]{device\+\_\+ref }\end{DoxyParamCaption})}

\begin{DoxyVerb}Read tcp socket and process packages.\end{DoxyVerb}
 \mbox{\Hypertarget{classlocal_1_1connection__handler_1_1LocalConnectionHandler_ae9be93d47c973e3c8afeed1b27fc7a4d}\label{classlocal_1_1connection__handler_1_1LocalConnectionHandler_ae9be93d47c973e3c8afeed1b27fc7a4d}} 
\index{local.connection\_handler.LocalConnectionHandler@{local.connection\_handler.LocalConnectionHandler}!search\_and\_send\_loop\_task\_alive@{search\_and\_send\_loop\_task\_alive}}
\index{search\_and\_send\_loop\_task\_alive@{search\_and\_send\_loop\_task\_alive}!local.connection\_handler.LocalConnectionHandler@{local.connection\_handler.LocalConnectionHandler}}
\doxysubsubsection{\texorpdfstring{search\_and\_send\_loop\_task\_alive()}{search\_and\_send\_loop\_task\_alive()}}
{\footnotesize\ttfamily  None local.\+connection\+\_\+handler.\+Local\+Connection\+Handler.\+search\+\_\+and\+\_\+send\+\_\+loop\+\_\+task\+\_\+alive (\begin{DoxyParamCaption}\item[{}]{self }\end{DoxyParamCaption})}

\begin{DoxyVerb}Ensure broadcast's and connection handler's task is alive.\end{DoxyVerb}
 \mbox{\Hypertarget{classlocal_1_1connection__handler_1_1LocalConnectionHandler_aae9d106df606f3c68a146e0af7f60bba}\label{classlocal_1_1connection__handler_1_1LocalConnectionHandler_aae9d106df606f3c68a146e0af7f60bba}} 
\index{local.connection\_handler.LocalConnectionHandler@{local.connection\_handler.LocalConnectionHandler}!send\_message@{send\_message}}
\index{send\_message@{send\_message}!local.connection\_handler.LocalConnectionHandler@{local.connection\_handler.LocalConnectionHandler}}
\doxysubsubsection{\texorpdfstring{send\_message()}{send\_message()}}
{\footnotesize\ttfamily  \mbox{\hyperlink{classklyqa__ctl_1_1general_1_1message_1_1Message}{Message}} $\vert$ None local.\+connection\+\_\+handler.\+Local\+Connection\+Handler.\+send\+\_\+message (\begin{DoxyParamCaption}\item[{}]{self,  }\item[{list\mbox{[}\mbox{\hyperlink{classklyqa__ctl_1_1general_1_1general_1_1Command}{Command}}\mbox{]}}]{send\+\_\+msgs,  }\item[{\mbox{\hyperlink{classklyqa__ctl_1_1general_1_1unit__id_1_1UnitId}{Unit\+Id}}}]{target\+\_\+device\+\_\+uid,  }\item[{float }]{time\+\_\+to\+\_\+live\+\_\+secs = {\ttfamily -\/1.0},  }\item[{$\ast$$\ast$Any}]{kwargs }\end{DoxyParamCaption})}

\begin{DoxyVerb}Add message to message's queue.\end{DoxyVerb}
 \mbox{\Hypertarget{classlocal_1_1connection__handler_1_1LocalConnectionHandler_a69a2aabf1a7bc94f925f914df5ceae10}\label{classlocal_1_1connection__handler_1_1LocalConnectionHandler_a69a2aabf1a7bc94f925f914df5ceae10}} 
\index{local.connection\_handler.LocalConnectionHandler@{local.connection\_handler.LocalConnectionHandler}!send\_udp\_broadcast@{send\_udp\_broadcast}}
\index{send\_udp\_broadcast@{send\_udp\_broadcast}!local.connection\_handler.LocalConnectionHandler@{local.connection\_handler.LocalConnectionHandler}}
\doxysubsubsection{\texorpdfstring{send\_udp\_broadcast()}{send\_udp\_broadcast()}}
{\footnotesize\ttfamily  bool local.\+connection\+\_\+handler.\+Local\+Connection\+Handler.\+send\+\_\+udp\+\_\+broadcast (\begin{DoxyParamCaption}\item[{}]{self }\end{DoxyParamCaption})}

\begin{DoxyVerb}Send qcx-syn broadcast on udp socket.\end{DoxyVerb}
 \mbox{\Hypertarget{classlocal_1_1connection__handler_1_1LocalConnectionHandler_aed3640a60ff23b9532ca91ebd2a9d01a}\label{classlocal_1_1connection__handler_1_1LocalConnectionHandler_aed3640a60ff23b9532ca91ebd2a9d01a}} 
\index{local.connection\_handler.LocalConnectionHandler@{local.connection\_handler.LocalConnectionHandler}!standby@{standby}}
\index{standby@{standby}!local.connection\_handler.LocalConnectionHandler@{local.connection\_handler.LocalConnectionHandler}}
\doxysubsubsection{\texorpdfstring{standby()}{standby()}}
{\footnotesize\ttfamily  None local.\+connection\+\_\+handler.\+Local\+Connection\+Handler.\+standby (\begin{DoxyParamCaption}\item[{}]{self }\end{DoxyParamCaption})}

\begin{DoxyVerb}Standby search devices and create incoming connection tasks.\end{DoxyVerb}
 

The documentation for this class was generated from the following file\+:\begin{DoxyCompactItemize}
\item 
communication/local/connection\+\_\+handler.\+py\end{DoxyCompactItemize}
